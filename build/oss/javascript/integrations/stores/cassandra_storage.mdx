---
title: Cassandra KV
---

이 예제는 `CassandraKVStore` [`BaseStore`](https://langchain-ai.github.io/langgraphjs/reference/classes/checkpoint.BaseStore.html) 통합을 사용하여 채팅 기록 저장소를 설정하는 방법을 보여줍니다. 채팅 기록 저장에는 `CassandraChatMessageHistory` 통합이 더 사용하기 쉬울 수 있습니다. `CassandraKVStore`는 접두사를 붙일 수 있는 키를 가진 보다 범용적인 key-value 저장소가 필요한 경우에 유용합니다.

## Setup

```bash npm
npm install @langchain/community @langchain/core cassandra-driver
```
데이터베이스 제공업체에 따라 데이터베이스에 연결하는 방법의 세부 사항이 다를 수 있습니다. 저장소 구성의 일부로 사용될 `configConnection` 문서를 생성합니다.

### Apache Cassandra®

Storage Attached Indexes(`yieldKeys`에서 사용)는 [Apache Cassandra® 5.0](https://cassandra.apache.org/_/blog/Apache-Cassandra-5.0-Features-Storage-Attached-Indexes.html) 이상에서 지원됩니다. 표준 연결 문서를 사용할 수 있습니다. 예를 들어:

```typescript
const configConnection = {
  contactPoints: ['h1', 'h2'],
  localDataCenter: 'datacenter1',
  credentials: {
    username: <...> as string,
    password: <...> as string,
  },
};
```
### Astra DB

Astra DB는 클라우드 네이티브 Cassandra-as-a-Service 플랫폼입니다.

1. [Astra DB 계정](https://astra.datastax.com/register)을 생성합니다.
2. [vector 지원 데이터베이스](https://astra.datastax.com/createDatabase)를 생성합니다.
3. 데이터베이스용 [토큰](https://docs.datastax.com/en/astra/docs/manage-application-tokens.html)을 생성합니다.

```typescript
const configConnection = {
  serviceProviderArgs: {
    astra: {
      token: <...> as string,
      endpoint: <...> as string,
    },
  },
};
```

`endpoint:` 대신 `datacenterID:` 속성과 선택적으로 `regionName:`을 제공할 수 있습니다.

## Usage

```typescript
import { CassandraKVStore } from "@langchain/community/storage/cassandra";
import { AIMessage, HumanMessage } from "@langchain/core/messages";

// This document is the Cassandra driver connection document; the example is to AstraDB but
// any valid Cassandra connection can be used.
const configConnection = {
  serviceProviderArgs: {
    astra: {
      token: "YOUR_TOKEN_OR_LOAD_FROM_ENV" as string,
      endpoint: "YOUR_ENDPOINT_OR_LOAD_FROM_ENV" as string,
    },
  },
};

const store = new CassandraKVStore({
  ...configConnection,
  keyspace: "test", // keyspace must exist
  table: "test_kv", // table will be created if it does not exist
  keyDelimiter: ":", // optional, default is "/"
});

// Define our encoder/decoder for converting between strings and Uint8Arrays
const encoder = new TextEncoder();
const decoder = new TextDecoder();

/**
 * Here you would define your LLM and chat chain, call
 * the LLM and eventually get a list of messages.
 * For this example, we'll assume we already have a list.
 */
const messages = Array.from({ length: 5 }).map((_, index) => {
  if (index % 2 === 0) {
    return new AIMessage("ai stuff...");
  }
  return new HumanMessage("human stuff...");
});

// Set your messages in the store
// The key will be prefixed with `message:id:` and end
// with the index.
await store.mset(
  messages.map((message, index) => [
    `message:id:${index}`,
    encoder.encode(JSON.stringify(message)),
  ])
);

// Now you can get your messages from the store
const retrievedMessages = await store.mget(["message:id:0", "message:id:1"]);
// Make sure to decode the values
console.log(retrievedMessages.map((v) => decoder.decode(v)));

/**
[
  '{"id":["langchain","AIMessage"],"kwargs":{"content":"ai stuff..."}}',
  '{"id":["langchain","HumanMessage"],"kwargs":{"content":"human stuff..."}}'
]
 */

// Or, if you want to get back all the keys you can call
// the `yieldKeys` method.
// Optionally, you can pass a key prefix to only get back
// keys which match that prefix.
const yieldedKeys = [];
for await (const key of store.yieldKeys("message:id:")) {
  yieldedKeys.push(key);
}

// The keys are not encoded, so no decoding is necessary
console.log(yieldedKeys);
/**
[
  'message:id:2',
  'message:id:1',
  'message:id:3',
  'message:id:0',
  'message:id:4'
]
 */

// Finally, let's delete the keys from the store
await store.mdelete(yieldedKeys);
```

## Related

- [Key-value store 개념 가이드](/oss/javascript/integrations/stores)
```

---

<Callout icon="pen-to-square" iconType="regular">
    [Edit the source of this page on GitHub.](https://github.com/langchain-ai/docs/edit/main/src/oss/javascript/integrations/stores/cassandra_storage.mdx)
</Callout>
<Tip icon="terminal" iconType="regular">
    [Connect these docs programmatically](/use-these-docs) to Claude, VSCode, and more via MCP for    real-time answers.
</Tip>
