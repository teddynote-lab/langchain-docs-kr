---
title: PGVectorStore
---

<Tip>
**호환성**: Node.js에서만 사용 가능합니다.
</Tip>

일반 PostgreSQL 데이터베이스에서 벡터 검색을 활성화하기 위해, LangChain.js는 [`pgvector`](https://github.com/pgvector/pgvector) Postgres extension 사용을 지원합니다.

이 가이드는 PGVector [vector store](/oss/javascript/integrations/vectorstores) 시작하기에 대한 간단한 개요를 제공합니다. 모든 `PGVectorStore` 기능 및 구성에 대한 자세한 문서는 [API reference](https://api.js.langchain.com/classes/langchain_community_vectorstores_pgvector.PGVectorStore.html)를 참조하세요.

## 개요

### Integration 세부 정보

| Class | Package | [PY support](https://python.langchain.com/docs/integrations/vectorstores/pgvector/) | Version |
| :--- | :--- | :---: | :---: |
| [`PGVectorStore`](https://api.js.langchain.com/classes/langchain_community_vectorstores_pgvector.PGVectorStore.html) | [`@langchain/community`](https://npmjs.com/@langchain/community) | ✅ | ![NPM - Version](https://img.shields.io/npm/v/@langchain/community?style=flat-square&label=%20&) |

## 설정

PGVector vector store를 사용하려면 [`pgvector`](https://github.com/pgvector/pgvector) extension이 활성화된 Postgres 인스턴스를 설정해야 합니다. 또한 [`pg`](https://www.npmjs.com/package/pg) 패키지를 peer dependency로 사용하여 `@langchain/community` integration 패키지를 설치해야 합니다.

이 가이드는 [OpenAI embeddings](/oss/javascript/integrations/text_embedding/openai)도 사용하며, 이를 위해 `@langchain/openai` integration 패키지를 설치해야 합니다. 원하는 경우 [다른 지원되는 embeddings 모델](/oss/javascript/integrations/text_embedding)을 사용할 수도 있습니다.

또한 필요한 형식으로 id를 생성하기 위해 [`uuid`](https://www.npmjs.com/package/uuid) 패키지를 사용합니다.

<CodeGroup>
```bash npm
npm install @langchain/community @langchain/openai @langchain/core pg uuid
```
```bash yarn
yarn add @langchain/community @langchain/openai @langchain/core pg uuid
```
```bash pnpm
pnpm add @langchain/community @langchain/openai @langchain/core pg uuid
```
</CodeGroup>

### 인스턴스 설정

인스턴스 설정 방법에 따라 Postgres에 연결하는 방법은 여러 가지가 있습니다. 다음은 `pgvector` 팀에서 제공하는 사전 빌드된 Docker 이미지를 사용한 로컬 설정의 한 예입니다.

아래 내용으로 docker-compose.yml이라는 파일을 생성하세요:

```yaml
# Run this command to start the database:
# docker compose up
services:
  db:
    hostname: 127.0.0.1
    image: pgvector/pgvector:pg16
    ports:
      - 5432:5432
    restart: always
    environment:
      - POSTGRES_DB=api
      - POSTGRES_USER=myuser
      - POSTGRES_PASSWORD=ChangeMe
```

그런 다음 같은 디렉토리에서 `docker compose up`을 실행하여 컨테이너를 시작하세요.

pgvector 설정 방법에 대한 자세한 정보는 [공식 저장소](https://github.com/pgvector/pgvector/)에서 확인할 수 있습니다.

### 자격 증명

Postgres 인스턴스에 연결하려면 해당 자격 증명이 필요합니다. 지원되는 옵션의 전체 목록은 [`node-postgres` docs](https://node-postgres.com/apis/client)를 참조하세요.

이 가이드에서 OpenAI embeddings를 사용하는 경우 OpenAI 키도 설정해야 합니다:

```typescript
process.env.OPENAI_API_KEY = "YOUR_API_KEY";
```

모델 호출에 대한 자동 추적을 원하는 경우 아래 주석을 해제하여 [LangSmith](https://docs.smith.langchain.com/) API 키를 설정할 수도 있습니다:

```typescript
// process.env.LANGSMITH_TRACING="true"
// process.env.LANGSMITH_API_KEY="your-api-key"
```

## 인스턴스화

vector store를 인스턴스화하려면 `.initialize()` static 메서드를 호출하세요. 이는 전달된 `config`의 `tableName`으로 지정된 테이블의 존재 여부를 자동으로 확인합니다. 테이블이 없으면 필요한 컬럼으로 생성합니다.

<Warning>
**보안**: 사용자 이름과 같은 사용자 생성 데이터는 테이블 및 컬럼 이름의 입력으로 사용해서는 안 됩니다.
**이는 SQL Injection으로 이어질 수 있습니다!**
</Warning>

```typescript
import {
  PGVectorStore,
  DistanceStrategy,
} from "@langchain/community/vectorstores/pgvector";
import { OpenAIEmbeddings } from "@langchain/openai";
import { PoolConfig } from "pg";

const embeddings = new OpenAIEmbeddings({
  model: "text-embedding-3-small",
});

// Sample config
const config = {
  postgresConnectionOptions: {
    type: "postgres",
    host: "127.0.0.1",
    port: 5433,
    user: "myuser",
    password: "ChangeMe",
    database: "api",
  } as PoolConfig,
  tableName: "testlangchainjs",
  columns: {
    idColumnName: "id",
    vectorColumnName: "vector",
    contentColumnName: "content",
    metadataColumnName: "metadata",
  },
  // supported distance strategies: cosine (default), innerProduct, or euclidean
  distanceStrategy: "cosine" as DistanceStrategy,
};

const vectorStore = await PGVectorStore.initialize(
  embeddings,
  config
);
```

## Vector store 관리

### Vector store에 항목 추가

```typescript
import { v4 as uuidv4 } from "uuid";
import type { Document } from "@langchain/core/documents";

const document1: Document = {
  pageContent: "The powerhouse of the cell is the mitochondria",
  metadata: { source: "https://example.com" }
};

const document2: Document = {
  pageContent: "Buildings are made out of brick",
  metadata: { source: "https://example.com" }
};

const document3: Document = {
  pageContent: "Mitochondria are made out of lipids",
  metadata: { source: "https://example.com" }
};

const document4: Document = {
  pageContent: "The 2024 Olympics are in Paris",
  metadata: { source: "https://example.com" }
}

const documents = [document1, document2, document3, document4];

const ids = [uuidv4(), uuidv4(), uuidv4(), uuidv4()]

await vectorStore.addDocuments(documents, { ids: ids });
```

### Vector store에서 항목 삭제

```typescript
const id4 = ids[ids.length - 1];

await vectorStore.delete({ ids: [id4] });
```

## Vector store 쿼리

Vector store가 생성되고 관련 문서가 추가되면 chain 또는 agent 실행 중에 쿼리하고 싶을 것입니다.

### 직접 쿼리

간단한 유사도 검색은 다음과 같이 수행할 수 있습니다:

```typescript
const filter = { source: "https://example.com" };

const similaritySearchResults = await vectorStore.similaritySearch("biology", 2, filter);

for (const doc of similaritySearchResults) {
  console.log(`* ${doc.pageContent} [${JSON.stringify(doc.metadata, null)}]`);
}
```

```output
* The powerhouse of the cell is the mitochondria [{"source":"https://example.com"}]
* Mitochondria are made out of lipids [{"source":"https://example.com"}]
```

위의 필터 구문은 정확한 일치를 지원하지만 다음도 지원됩니다:

#### `in` operator 사용

```json
{
  "field": {
    "in": ["value1", "value2"],
  }
}
```

#### `notIn` operator 사용

```json
{
  "field": {
    "notIn": ["value1", "value2"],
  }
}
```

#### `arrayContains` operator 사용

```json
{
  "field": {
    "arrayContains": ["value1", "value2"],
  }
}
```

유사도 검색을 실행하고 해당 점수를 받으려면 다음을 실행할 수 있습니다:

```typescript
const similaritySearchWithScoreResults = await vectorStore.similaritySearchWithScore("biology", 2, filter)

for (const [doc, score] of similaritySearchWithScoreResults) {
  console.log(`* [SIM=${score.toFixed(3)}] ${doc.pageContent} [${JSON.stringify(doc.metadata)}]`);
}
```

```output
* [SIM=0.835] The powerhouse of the cell is the mitochondria [{"source":"https://example.com"}]
* [SIM=0.852] Mitochondria are made out of lipids [{"source":"https://example.com"}]
```

### Retriever로 변환하여 쿼리

Vector store를 [retriever](/oss/javascript/langchain/retrieval)로 변환하여 chain에서 더 쉽게 사용할 수도 있습니다.

```typescript
const retriever = vectorStore.asRetriever({
  // Optional filter
  filter: filter,
  k: 2,
});
await retriever.invoke("biology");
```

```output
[
  Document {
    pageContent: 'The powerhouse of the cell is the mitochondria',
    metadata: { source: 'https://example.com' },
    id: undefined
  },
  Document {
    pageContent: 'Mitochondria are made out of lipids',
    metadata: { source: 'https://example.com' },
    id: undefined
  }
]
```

### Retrieval-augmented generation 사용

이 vector store를 retrieval-augmented generation (RAG)에 사용하는 방법에 대한 가이드는 다음 섹션을 참조하세요:

- [LangChain으로 RAG 앱 구축하기](/oss/javascript/langchain/rag)
- [Agentic RAG](/oss/javascript/langgraph/agentic-rag)
- [Retrieval 문서](/oss/javascript/langchain/retrieval)

## 고급: 연결 재사용

pool을 생성한 다음 constructor를 통해 직접 새 `PGVectorStore` 인스턴스를 생성하여 연결을 재사용할 수 있습니다.

constructor를 사용하기 전에 테이블을 올바르게 설정하려면 최소한 한 번은 `.initialize()`를 호출하여 데이터베이스를 설정해야 합니다.

```typescript
import { OpenAIEmbeddings } from "@langchain/openai";
import { PGVectorStore } from "@langchain/community/vectorstores/pgvector";
import pg from "pg";

// First, follow set-up instructions at
// https://js.langchain.com/docs/modules/indexes/vector_stores/integrations/pgvector

const reusablePool = new pg.Pool({
  host: "127.0.0.1",
  port: 5433,
  user: "myuser",
  password: "ChangeMe",
  database: "api",
});

const originalConfig = {
  pool: reusablePool,
  tableName: "testlangchainjs",
  collectionName: "sample",
  collectionTableName: "collections",
  columns: {
    idColumnName: "id",
    vectorColumnName: "vector",
    contentColumnName: "content",
    metadataColumnName: "metadata",
  },
};

// Set up the DB.
// Can skip this step if you've already initialized the DB.
// await PGVectorStore.initialize(new OpenAIEmbeddings(), originalConfig);
const pgvectorStore = new PGVectorStore(new OpenAIEmbeddings(), originalConfig);

await pgvectorStore.addDocuments([
  { pageContent: "what's this", metadata: { a: 2 } },
  { pageContent: "Cat drinks milk", metadata: { a: 1 } },
]);

const results = await pgvectorStore.similaritySearch("water", 1);

console.log(results);

/*
  [ Document { pageContent: 'Cat drinks milk', metadata: { a: 1 } } ]
*/

const pgvectorStore2 = new PGVectorStore(new OpenAIEmbeddings(), {
  pool: reusablePool,
  tableName: "testlangchainjs",
  collectionTableName: "collections",
  collectionName: "some_other_collection",
  columns: {
    idColumnName: "id",
    vectorColumnName: "vector",
    contentColumnName: "content",
    metadataColumnName: "metadata",
  },
});

const results2 = await pgvectorStore2.similaritySearch("water", 1);

console.log(results2);

/*
  []
*/

await reusablePool.end();
```

## HNSW Index 생성

기본적으로 extension은 100% recall로 순차 스캔 검색을 수행합니다. `similaritySearchVectorWithScore` 실행 시간을 단축하기 위해 approximate nearest neighbor (ANN) 검색을 위한 HNSW index 생성을 고려할 수 있습니다. vector 컬럼에 HNSW index를 생성하려면 `createHnswIndex()` 메서드를 사용하세요.

메서드 매개변수는 다음과 같습니다:

- `dimensions`: vector 데이터 타입의 차원 수를 정의하며, 최대 2000까지 가능합니다. 예를 들어 OpenAI의 text-embedding-ada-002 및 Amazon의 amazon.titan-embed-text-v1 모델에는 1536을 사용합니다.

- `m?`: 레이어당 최대 연결 수 (기본값 16). 값이 작을수록 index 빌드 시간이 개선되며, 값이 클수록 검색 쿼리 속도가 빨라질 수 있습니다.

- `efConstruction?`: 그래프 구성을 위한 동적 후보 목록의 크기 (기본값 64). 값이 높을수록 index 빌드 시간을 희생하여 index 품질이 향상될 수 있습니다.

- `distanceFunction?`: 사용하려는 거리 함수 이름으로, distanceStrategy에 따라 자동으로 선택됩니다.

자세한 정보는 [Pgvector GitHub repo](https://github.com/pgvector/pgvector?tab=readme-ov-file#hnsw) 및 [HNSW paper from Malkov Yu A. and Yashunin D. A.. 2020. Efficient and robust approximate nearest neighbor search using hierarchical navigable small world graphs](https://arxiv.org/pdf/1603.09320)를 참조하세요.

```typescript
import { OpenAIEmbeddings } from "@langchain/openai";
import {
  DistanceStrategy,
  PGVectorStore,
} from "@langchain/community/vectorstores/pgvector";
import { PoolConfig } from "pg";

// First, follow set-up instructions at
// https://js.langchain.com/docs/modules/indexes/vector_stores/integrations/pgvector

const hnswConfig = {
  postgresConnectionOptions: {
    type: "postgres",
    host: "127.0.0.1",
    port: 5433,
    user: "myuser",
    password: "ChangeMe",
    database: "api",
  } as PoolConfig,
  tableName: "testlangchainjs",
  columns: {
    idColumnName: "id",
    vectorColumnName: "vector",
    contentColumnName: "content",
    metadataColumnName: "metadata",
  },
  // supported distance strategies: cosine (default), innerProduct, or euclidean
  distanceStrategy: "cosine" as DistanceStrategy,
};

const hnswPgVectorStore = await PGVectorStore.initialize(
  new OpenAIEmbeddings(),
  hnswConfig
);

// create the index
await hnswPgVectorStore.createHnswIndex({
  dimensions: 1536,
  efConstruction: 64,
  m: 16,
});

await hnswPgVectorStore.addDocuments([
  { pageContent: "what's this", metadata: { a: 2, b: ["tag1", "tag2"] } },
  { pageContent: "Cat drinks milk", metadata: { a: 1, b: ["tag2"] } },
]);

const model = new OpenAIEmbeddings();
const query = await model.embedQuery("water");
const hnswResults = await hnswPgVectorStore.similaritySearchVectorWithScore(query, 1);

console.log(hnswResults);

await pgvectorStore.end();
```

## 연결 종료

과도한 리소스 소비를 방지하기 위해 작업이 완료되면 연결을 종료해야 합니다:

```typescript
await vectorStore.end();
```

## API reference

모든 `PGVectorStore` 기능 및 구성에 대한 자세한 문서는 [API reference](https://api.js.langchain.com/classes/langchain_community_vectorstores_pgvector.PGVectorStore.html)를 참조하세요.

---

<Callout icon="pen-to-square" iconType="regular">
    [Edit the source of this page on GitHub.](https://github.com/langchain-ai/docs/edit/main/src/oss/javascript/integrations/vectorstores/pgvector.mdx)
</Callout>
<Tip icon="terminal" iconType="regular">
    [Connect these docs programmatically](/use-these-docs) to Claude, VSCode, and more via MCP for    real-time answers.
</Tip>
