---
title: Cloudflare Vectorize
---

Cloudflare worker에 프로젝트를 배포하는 경우, LangChain.js와 함께 [Cloudflare Vectorize](https://developers.cloudflare.com/vectorize/)를 사용할 수 있습니다.
Cloudflare에 직접 내장된 강력하고 편리한 옵션입니다.

## Setup

<Tip>
**호환성**

Cloudflare Vectorize는 현재 오픈 베타 단계이며, 사용하려면 유료 플랜의 Cloudflare 계정이 필요합니다.
</Tip>

[프로젝트 설정](https://developers.cloudflare.com/vectorize/get-started/intro/#prerequisites) 후,
다음 Wrangler 명령을 실행하여 index를 생성하세요:

```bash
$ npx wrangler vectorize create <index_name> --preset @cf/baai/bge-small-en-v1.5
```

`vectorize` 명령의 전체 옵션 목록은 [공식 문서](https://developers.cloudflare.com/workers/wrangler/commands/#vectorize)에서 확인할 수 있습니다.

그런 다음 `wrangler.toml` 파일을 업데이트하여 `[[vectorize]]` 항목을 포함해야 합니다:

```toml
[[vectorize]]
binding = "VECTORIZE_INDEX"
index_name = "<index_name>"
```

마지막으로 LangChain Cloudflare integration package를 설치해야 합니다:

<Tip>
LangChain package 설치에 대한 일반적인 지침은 [이 섹션](/oss/javascript/langchain/install)을 참조하세요.
</Tip>

```bash npm
npm install @langchain/cloudflare @langchain/core
```
## Usage

다음은 사용된 경로에 따라 vectorstore에 문서를 추가하거나, 쿼리하거나, 지우는 worker의 예시입니다. 또한 [Cloudflare Workers AI Embeddings](/oss/javascript/integrations/text_embedding/cloudflare_ai)를 사용합니다.

<Note>
로컬에서 실행하는 경우, wrangler를 `npx wrangler dev --remote`로 실행해야 합니다!
</Note>

```toml
name = "langchain-test"
main = "worker.ts"
compatibility_date = "2024-01-10"

[[vectorize]]
binding = "VECTORIZE_INDEX"
index_name = "langchain-test"

[ai]
binding = "AI"
```

```typescript
// @ts-nocheck

import type {
  VectorizeIndex,
  Fetcher,
  Request,
} from "@cloudflare/workers-types";

import {
  CloudflareVectorizeStore,
  CloudflareWorkersAIEmbeddings,
} from "@langchain/cloudflare";

export interface Env {
  VECTORIZE_INDEX: VectorizeIndex;
  AI: Fetcher;
}

export default {
  async fetch(request: Request, env: Env) {
    const { pathname } = new URL(request.url);
    const embeddings = new CloudflareWorkersAIEmbeddings({
      binding: env.AI,
      model: "@cf/baai/bge-small-en-v1.5",
    });
    const store = new CloudflareVectorizeStore(embeddings, {
      index: env.VECTORIZE_INDEX,
    });
    if (pathname === "/") {
      const results = await store.similaritySearch("hello", 5);
      return Response.json(results);
    } else if (pathname === "/load") {
      // Upsertion by id is supported
      await store.addDocuments(
        [
          {
            pageContent: "hello",
            metadata: {},
          },
          {
            pageContent: "world",
            metadata: {},
          },
          {
            pageContent: "hi",
            metadata: {},
          },
        ],
        { ids: ["id1", "id2", "id3"] }
      );

      return Response.json({ success: true });
    } else if (pathname === "/clear") {
      await store.delete({ ids: ["id1", "id2", "id3"] });
      return Response.json({ success: true });
    }

    return Response.json({ error: "Not Found" }, { status: 404 });
  },
};
```

이전에 로드된 metadata로 필터링하기 위해 `filter` parameter를 전달할 수도 있습니다.
필요한 형식에 대한 정보는 [공식 문서](https://developers.cloudflare.com/vectorize/learning/metadata-filtering/)를 참조하세요.

## Related

- Vector store [개념 가이드](/oss/javascript/integrations/vectorstores)
- Vector store [사용 방법 가이드](/oss/javascript/integrations/vectorstores)

---

<Callout icon="pen-to-square" iconType="regular">
    [Edit the source of this page on GitHub.](https://github.com/langchain-ai/docs/edit/main/src/oss/javascript/integrations/vectorstores/cloudflare_vectorize.mdx)
</Callout>
<Tip icon="terminal" iconType="regular">
    [Connect these docs programmatically](/use-these-docs) to Claude, VSCode, and more via MCP for    real-time answers.
</Tip>
