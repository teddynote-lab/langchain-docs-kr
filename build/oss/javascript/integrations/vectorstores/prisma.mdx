---
title: Prisma
---

PostgreSQL 데이터베이스의 기존 모델에 벡터 검색을 추가하기 위해, LangChain은 PostgreSQL 및 [`pgvector`](https://github.com/pgvector/pgvector) Postgres extension과 함께 [Prisma](https://www.prisma.io/)를 사용하는 것을 지원합니다.

## Setup

### Supabase로 데이터베이스 인스턴스 설정하기

Supabase와 Prisma로 새 데이터베이스 인스턴스를 설정하려면 [Prisma와 Supabase 통합 가이드](https://supabase.com/docs/guides/integrations/prisma)를 참조하세요.

### Prisma 설치

```bash npm
npm install prisma
```
### `docker-compose`로 `pgvector` 자체 호스팅 인스턴스 설정하기

`pgvector`는 자체 호스팅 Postgres 인스턴스를 빠르게 설정하는 데 사용할 수 있는 사전 빌드된 Docker 이미지를 제공합니다.

```yaml
services:
  db:
    image: ankane/pgvector
    ports:
      - 5432:5432
    volumes:
      - db:/var/lib/postgresql/data
    environment:
      - POSTGRES_PASSWORD=
      - POSTGRES_USER=
      - POSTGRES_DB=

volumes:
  db:
```
### 새 스키마 생성하기

아직 스키마를 생성하지 않았다면, `Unsupported("vector")` 타입의 `vector` 필드를 가진 새 모델을 생성하세요:

```prisma
model Document {
  id      String                 @id @default(cuid())
  content String
  vector  Unsupported("vector")?
}
```
그런 다음, 마이그레이션을 직접 실행하지 않도록 `--create-only` 옵션으로 새 마이그레이션을 생성하세요.

```bash npm
npx prisma migrate dev --create-only
```
아직 활성화되지 않았다면 `pgvector` extension을 활성화하기 위해 새로 생성된 마이그레이션에 다음 줄을 추가하세요:

```sql
CREATE EXTENSION IF NOT EXISTS vector;
```
그런 다음 마이그레이션을 실행하세요:

```bash npm
npx prisma migrate dev
```
## Usage

<Tip>
LangChain 패키지 설치에 대한 일반적인 지침은 [이 섹션](/oss/javascript/langchain/install)을 참조하세요.
</Tip>

```bash npm
npm install @langchain/openai @langchain/community @langchain/core
```

<Warning>
**테이블 이름과 컬럼 이름(`tableName`, `vectorColumnName`, `columns`, `filter`와 같은 필드)은 매개변수화 없이 SQL 쿼리에 직접 전달됩니다.**

SQL injection을 방지하기 위해 이러한 필드는 사전에 sanitize되어야 합니다.
</Warning>

```typescript
import { PrismaVectorStore } from "@langchain/community/vectorstores/prisma";
import { OpenAIEmbeddings } from "@langchain/openai";
import { PrismaClient, Prisma, Document } from "@prisma/client";

export const run = async () => {
  const db = new PrismaClient();

  // Use the `withModel` method to get proper type hints for `metadata` field:
  const vectorStore = PrismaVectorStore.withModel<Document>(db).create(
    new OpenAIEmbeddings(),
    {
      prisma: Prisma,
      tableName: "Document",
      vectorColumnName: "vector",
      columns: {
        id: PrismaVectorStore.IdColumn,
        content: PrismaVectorStore.ContentColumn,
      },
    }
  );

  const texts = ["Hello world", "Bye bye", "What's this?"];
  await vectorStore.addModels(
    await db.$transaction(
      texts.map((content) => db.document.create({ data: { content } }))
    )
  );

  const resultOne = await vectorStore.similaritySearch("Hello world", 1);
  console.log(resultOne);

  // create an instance with default filter
  const vectorStore2 = PrismaVectorStore.withModel<Document>(db).create(
    new OpenAIEmbeddings(),
    {
      prisma: Prisma,
      tableName: "Document",
      vectorColumnName: "vector",
      columns: {
        id: PrismaVectorStore.IdColumn,
        content: PrismaVectorStore.ContentColumn,
      },
      filter: {
        content: {
          equals: "default",
        },
      },
    }
  );

  await vectorStore2.addModels(
    await db.$transaction(
      texts.map((content) => db.document.create({ data: { content } }))
    )
  );

  // Use the default filter a.k.a {"content": "default"}
  const resultTwo = await vectorStore.similaritySearch("Hello world", 1);
  console.log(resultTwo);
};
```

다음 SQL 연산자를 필터로 사용할 수 있습니다: `equals`, `in`, `isNull`, `isNotNull`, `like`, `lt`, `lte`, `gt`, `gte`, `not`.

위의 샘플은 다음 스키마를 사용합니다:

<SchemaPrisma />

필요하지 않다면 `namespace`를 제거할 수 있습니다.

## Related

- Vector store [개념 가이드](/oss/javascript/integrations/vectorstores)
- Vector store [사용 방법 가이드](/oss/javascript/integrations/vectorstores)

---

<Callout icon="pen-to-square" iconType="regular">
    [Edit the source of this page on GitHub.](https://github.com/langchain-ai/docs/edit/main/src/oss/javascript/integrations/vectorstores/prisma.mdx)
</Callout>
<Tip icon="terminal" iconType="regular">
    [Connect these docs programmatically](/use-these-docs) to Claude, VSCode, and more via MCP for    real-time answers.
</Tip>
