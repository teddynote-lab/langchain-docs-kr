---
title: Human-in-the-loop
---



Human-in-the-Loop (HITL) middlewareë¥¼ ì‚¬ìš©í•˜ë©´ ì—ì´ì „íŠ¸ tool í˜¸ì¶œì— ì‚¬ëŒì˜ ê°ë…ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ëª¨ë¸ì´ ê²€í† ê°€ í•„ìš”í•  ìˆ˜ ìˆëŠ” ì‘ì—…(ì˜ˆ: íŒŒì¼ ì“°ê¸° ë˜ëŠ” SQL ì‹¤í–‰)ì„ ì œì•ˆí•˜ë©´, middlewareëŠ” ì‹¤í–‰ì„ ì¼ì‹œ ì¤‘ì§€í•˜ê³  ê²°ì •ì„ ê¸°ë‹¤ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ëŠ” êµ¬ì„± ê°€ëŠ¥í•œ ì •ì±…ì— ë”°ë¼ ê° tool í˜¸ì¶œì„ í™•ì¸í•˜ì—¬ ìˆ˜í–‰ë©ë‹ˆë‹¤. ê°œì…ì´ í•„ìš”í•œ ê²½ìš°, middlewareëŠ” ì‹¤í–‰ì„ ì¤‘ë‹¨í•˜ëŠ” [interrupt](https://langchain-ai.github.io/langgraphjs/reference/functions/langgraph.interrupt-2.html)ë¥¼ ë°œìƒì‹œí‚µë‹ˆë‹¤. Graph stateëŠ” LangGraphì˜ [persistence layer](/oss/javascript/langgraph/persistence)ë¥¼ ì‚¬ìš©í•˜ì—¬ ì €ì¥ë˜ë¯€ë¡œ, ì‹¤í–‰ì„ ì•ˆì „í•˜ê²Œ ì¼ì‹œ ì¤‘ì§€í•˜ê³  ë‚˜ì¤‘ì— ì¬ê°œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê·¸ëŸ° ë‹¤ìŒ ì‚¬ëŒì˜ ê²°ì •ì— ë”°ë¼ ë‹¤ìŒ ì‘ì—…ì´ ê²°ì •ë©ë‹ˆë‹¤: ì‘ì—…ì„ ê·¸ëŒ€ë¡œ ìŠ¹ì¸(`approve`)í•˜ê±°ë‚˜, ì‹¤í–‰ ì „ì— ìˆ˜ì •(`edit`)í•˜ê±°ë‚˜, í”¼ë“œë°±ê³¼ í•¨ê»˜ ê±°ë¶€(`reject`)í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## Interrupt ê²°ì • ìœ í˜•

MiddlewareëŠ” ì‚¬ëŒì´ interruptì— ì‘ë‹µí•  ìˆ˜ ìˆëŠ” ì„¸ ê°€ì§€ ê¸°ë³¸ ì œê³µ ë°©ë²•ì„ ì •ì˜í•©ë‹ˆë‹¤:

| ê²°ì • ìœ í˜• | ì„¤ëª…                                                               | ì‚¬ìš© ì‚¬ë¡€ ì˜ˆì‹œ                                    |
|---------------|---------------------------------------------------------------------------|-----------------------------------------------------|
| âœ… `approve`   | ì‘ì—…ì´ ê·¸ëŒ€ë¡œ ìŠ¹ì¸ë˜ì–´ ë³€ê²½ ì—†ì´ ì‹¤í–‰ë©ë‹ˆë‹¤.                | ì‘ì„±ëœ ê·¸ëŒ€ë¡œ ì´ë©”ì¼ ì´ˆì•ˆ ë³´ë‚´ê¸°              |
| âœï¸ `edit`     | Tool í˜¸ì¶œì´ ìˆ˜ì •ê³¼ í•¨ê»˜ ì‹¤í–‰ë©ë‹ˆë‹¤.                             | ì´ë©”ì¼ì„ ë³´ë‚´ê¸° ì „ì— ìˆ˜ì‹ ì ë³€ê²½        |
| âŒ `reject`    | Tool í˜¸ì¶œì´ ê±°ë¶€ë˜ê³ , ì„¤ëª…ì´ ëŒ€í™”ì— ì¶”ê°€ë©ë‹ˆë‹¤. | ì´ë©”ì¼ ì´ˆì•ˆì„ ê±°ë¶€í•˜ê³  ë‹¤ì‹œ ì‘ì„±í•˜ëŠ” ë°©ë²• ì„¤ëª… |

ê° toolì— ì‚¬ìš© ê°€ëŠ¥í•œ ê²°ì • ìœ í˜•ì€ `interrupt_on`ì—ì„œ êµ¬ì„±í•œ ì •ì±…ì— ë”°ë¼ ë‹¤ë¦…ë‹ˆë‹¤.
ì—¬ëŸ¬ tool í˜¸ì¶œì´ ë™ì‹œì— ì¼ì‹œ ì¤‘ì§€ë˜ë©´, ê° ì‘ì—…ì— ëŒ€í•´ ë³„ë„ì˜ ê²°ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.
ê²°ì •ì€ interrupt ìš”ì²­ì— ë‚˜íƒ€ë‚˜ëŠ” ì‘ì—…ê³¼ ë™ì¼í•œ ìˆœì„œë¡œ ì œê³µë˜ì–´ì•¼ í•©ë‹ˆë‹¤.

<Tip>
Tool argumentë¥¼ **í¸ì§‘**í•  ë•ŒëŠ” ì‹ ì¤‘í•˜ê²Œ ë³€ê²½í•˜ì„¸ìš”. ì›ë˜ argumentë¥¼ í¬ê²Œ ìˆ˜ì •í•˜ë©´ ëª¨ë¸ì´ ì ‘ê·¼ ë°©ì‹ì„ ì¬í‰ê°€í•˜ê³  toolì„ ì—¬ëŸ¬ ë²ˆ ì‹¤í–‰í•˜ê±°ë‚˜ ì˜ˆìƒì¹˜ ëª»í•œ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
</Tip>


## Interrupt êµ¬ì„±

HITLì„ ì‚¬ìš©í•˜ë ¤ë©´, ì—ì´ì „íŠ¸ë¥¼ ìƒì„±í•  ë•Œ ì—ì´ì „íŠ¸ì˜ `middleware` ëª©ë¡ì— middlewareë¥¼ ì¶”ê°€í•˜ì„¸ìš”.

ê° ì‘ì—…ì— í—ˆìš©ë˜ëŠ” ê²°ì • ìœ í˜•ì— ëŒ€í•œ tool ì‘ì—…ì˜ ë§¤í•‘ìœ¼ë¡œ êµ¬ì„±í•©ë‹ˆë‹¤. MiddlewareëŠ” tool í˜¸ì¶œì´ ë§¤í•‘ì˜ ì‘ì—…ê³¼ ì¼ì¹˜í•  ë•Œ ì‹¤í–‰ì„ ì¤‘ë‹¨í•©ë‹ˆë‹¤.



```ts
import { createAgent, humanInTheLoopMiddleware } from "langchain"; // [!code highlight]
import { MemorySaver } from "@langchain/langgraph"; // [!code highlight]

const agent = createAgent({
    model: "openai:gpt-4o",
    tools: [writeFileTool, executeSQLTool, readDataTool],
    middleware: [
        humanInTheLoopMiddleware({
            interruptOn: {
                write_file: true, // All decisions (approve, edit, reject) allowed
                execute_sql: {
                    allowedDecisions: ["approve", "reject"],
                    // No editing allowed
                    description: "ğŸš¨ SQL execution requires DBA approval",
                },
                // Safe operation, no approval needed
                read_data: false,
            },
            // Prefix for interrupt messages - combined with tool name and args to form the full message
            // e.g., "Tool execution pending approval: execute_sql with query='DELETE FROM...'"
            // Individual tools can override this by specifying a "description" in their interrupt config
            descriptionPrefix: "Tool execution pending approval",
        }),
    ],
    // Human-in-the-loop requires checkpointing to handle interrupts.
    // In production, use a persistent checkpointer like AsyncPostgresSaver.
    checkpointer: new MemorySaver(), // [!code highlight]
});
```



<Info>
    Interrupt ê°„ì— graph stateë¥¼ ìœ ì§€í•˜ë ¤ë©´ checkpointerë¥¼ êµ¬ì„±í•´ì•¼ í•©ë‹ˆë‹¤.
    í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œëŠ” @[`AsyncPostgresSaver`]ì™€ ê°™ì€ ì˜êµ¬ checkpointerë¥¼ ì‚¬ìš©í•˜ì„¸ìš”. í…ŒìŠ¤íŠ¸ ë˜ëŠ” í”„ë¡œí† íƒ€ì´í•‘ì˜ ê²½ìš° @[`InMemorySaver`]ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.

    ì—ì´ì „íŠ¸ë¥¼ í˜¸ì¶œí•  ë•Œ, ì‹¤í–‰ì„ ëŒ€í™” ìŠ¤ë ˆë“œì™€ ì—°ê²°í•˜ê¸° ìœ„í•´ **thread ID**ë¥¼ í¬í•¨í•˜ëŠ” `config`ë¥¼ ì „ë‹¬í•˜ì„¸ìš”.
    ìì„¸í•œ ë‚´ìš©ì€ [LangGraph interrupts ë¬¸ì„œ](/oss/javascript/langgraph/interrupts)ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.
</Info>


## Interruptì— ì‘ë‹µí•˜ê¸°

ì—ì´ì „íŠ¸ë¥¼ í˜¸ì¶œí•˜ë©´, ì™„ë£Œë˜ê±°ë‚˜ interruptê°€ ë°œìƒí•  ë•Œê¹Œì§€ ì‹¤í–‰ë©ë‹ˆë‹¤. InterruptëŠ” tool í˜¸ì¶œì´ `interrupt_on`ì—ì„œ êµ¬ì„±í•œ ì •ì±…ê³¼ ì¼ì¹˜í•  ë•Œ íŠ¸ë¦¬ê±°ë©ë‹ˆë‹¤. ì´ ê²½ìš°, í˜¸ì¶œ ê²°ê³¼ì—ëŠ” ê²€í† ê°€ í•„ìš”í•œ ì‘ì—…ì´ í¬í•¨ëœ `__interrupt__` í•„ë“œê°€ í¬í•¨ë©ë‹ˆë‹¤. ê·¸ëŸ° ë‹¤ìŒ í•´ë‹¹ ì‘ì—…ì„ ê²€í† ìì—ê²Œ ì œì‹œí•˜ê³  ê²°ì •ì´ ì œê³µë˜ë©´ ì‹¤í–‰ì„ ì¬ê°œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.




```typescript
import { HumanMessage } from "@langchain/core/messages";
import { Command } from "@langchain/langgraph";

// You must provide a thread ID to associate the execution with a conversation thread,
// so the conversation can be paused and resumed (as is needed for human review).
const config = { configurable: { thread_id: "some_id" } }; // [!code highlight]

// Run the graph until the interrupt is hit.
const result = await agent.invoke(
    {
        messages: [new HumanMessage("Delete old records from the database")],
    },
    config // [!code highlight]
);


// The interrupt contains the full HITL request with action_requests and review_configs
console.log(result.__interrupt__);
// > [
// >    Interrupt(
// >       value: {
// >          action_requests: [
// >             {
// >                name: 'execute_sql',
// >                arguments: { query: 'DELETE FROM records WHERE created_at < NOW() - INTERVAL \'30 days\';' },
// >                description: 'Tool execution pending approval\n\nTool: execute_sql\nArgs: {...}'
// >             }
// >          ],
// >          review_configs: [
// >             {
// >                action_name: 'execute_sql',
// >                allowed_decisions: ['approve', 'reject']
// >             }
// >          ]
// >       }
// >    )
// > ]

// Resume with approval decision
await agent.invoke(
    new Command({ // [!code highlight]
        resume: { decisions: [{ type: "approve" }] }, // or "edit", "reject" [!code highlight]
    }), // [!code highlight]
    config // Same thread ID to resume the paused conversation
);
```


### ê²°ì • ìœ í˜•

<Tabs>
<Tab title="âœ… approve">
`approve`ë¥¼ ì‚¬ìš©í•˜ì—¬ tool í˜¸ì¶œì„ ê·¸ëŒ€ë¡œ ìŠ¹ì¸í•˜ê³  ë³€ê²½ ì—†ì´ ì‹¤í–‰í•˜ì„¸ìš”.



```typescript
await agent.invoke(
    new Command({
        // Decisions are provided as a list, one per action under review.
        // The order of decisions must match the order of actions
        // listed in the `__interrupt__` request.
        resume: {
            decisions: [
                {
                    type: "approve",
                }
            ]
        }
    }),
    config  // Same thread ID to resume the paused conversation
);
```

</Tab>
<Tab title="âœï¸ edit">
    `edit`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹¤í–‰ ì „ì— tool í˜¸ì¶œì„ ìˆ˜ì •í•˜ì„¸ìš”.
    ìƒˆ tool ì´ë¦„ê³¼ argumentë¡œ í¸ì§‘ëœ ì‘ì—…ì„ ì œê³µí•˜ì„¸ìš”.



    ```typescript
    await agent.invoke(
        new Command({
            // Decisions are provided as a list, one per action under review.
            // The order of decisions must match the order of actions
            // listed in the `__interrupt__` request.
            resume: {
                decisions: [
                    {
                        type: "edit",
                        // Edited action with tool name and args
                        editedAction: {
                            // Tool name to call.
                            // Will usually be the same as the original action.
                            name: "new_tool_name",
                            // Arguments to pass to the tool.
                            args: { key1: "new_value", key2: "original_value" },
                        }
                    }
                ]
            }
        }),
        config  // Same thread ID to resume the paused conversation
    );
    ```


    <Tip>
        Tool argumentë¥¼ **í¸ì§‘**í•  ë•ŒëŠ” ì‹ ì¤‘í•˜ê²Œ ë³€ê²½í•˜ì„¸ìš”. ì›ë˜ argumentë¥¼ í¬ê²Œ ìˆ˜ì •í•˜ë©´ ëª¨ë¸ì´ ì ‘ê·¼ ë°©ì‹ì„ ì¬í‰ê°€í•˜ê³  toolì„ ì—¬ëŸ¬ ë²ˆ ì‹¤í–‰í•˜ê±°ë‚˜ ì˜ˆìƒì¹˜ ëª»í•œ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    </Tip>

</Tab>

<Tab title="âŒ reject">
    `reject`ë¥¼ ì‚¬ìš©í•˜ì—¬ tool í˜¸ì¶œì„ ê±°ë¶€í•˜ê³  ì‹¤í–‰ ëŒ€ì‹  í”¼ë“œë°±ì„ ì œê³µí•˜ì„¸ìš”.



    ```typescript
    await agent.invoke(
        new Command({
            // Decisions are provided as a list, one per action under review.
            // The order of decisions must match the order of actions
            // listed in the `__interrupt__` request.
            resume: {
                decisions: [
                    {
                        type: "reject",
                        // An explanation about why the action was rejected
                        message: "No, this is wrong because ..., instead do this ...",
                    }
                ]
            }
        }),
        config  // Same thread ID to resume the paused conversation
    );
    ```


`message`ëŠ” ì—ì´ì „íŠ¸ê°€ ì‘ì—…ì´ ê±°ë¶€ëœ ì´ìœ ì™€ ëŒ€ì‹  ë¬´ì—‡ì„ í•´ì•¼ í•˜ëŠ”ì§€ ì´í•´í•˜ëŠ” ë° ë„ì›€ì´ ë˜ë„ë¡ ëŒ€í™”ì— í”¼ë“œë°±ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤.

---

### ì—¬ëŸ¬ ê²°ì •

ì—¬ëŸ¬ ì‘ì—…ì´ ê²€í†  ì¤‘ì¼ ë•Œ, interruptì— ë‚˜íƒ€ë‚˜ëŠ” ìˆœì„œì™€ ë™ì¼í•œ ìˆœì„œë¡œ ê° ì‘ì—…ì— ëŒ€í•œ ê²°ì •ì„ ì œê³µí•˜ì„¸ìš”:



```typescript
{
    decisions: [
        { type: "approve" },
        {
            type: "edit",
            editedAction: {
                name: "tool_name",
                args: { param: "new_value" }
            }
        },
        {
            type: "reject",
            message: "This action is not allowed"
        }
    ]
}
```


</Tab>
</Tabs>


## ì‹¤í–‰ ìƒëª…ì£¼ê¸°

MiddlewareëŠ” ëª¨ë¸ì´ ì‘ë‹µì„ ìƒì„±í•œ í›„ tool í˜¸ì¶œì´ ì‹¤í–‰ë˜ê¸° ì „ì— ì‹¤í–‰ë˜ëŠ” `after_model` hookì„ ì •ì˜í•©ë‹ˆë‹¤:

1. ì—ì´ì „íŠ¸ê°€ ëª¨ë¸ì„ í˜¸ì¶œí•˜ì—¬ ì‘ë‹µì„ ìƒì„±í•©ë‹ˆë‹¤.
2. Middlewareê°€ ì‘ë‹µì—ì„œ tool í˜¸ì¶œì„ ê²€ì‚¬í•©ë‹ˆë‹¤.
3. í˜¸ì¶œ ì¤‘ ì‚¬ëŒì˜ ì…ë ¥ì´ í•„ìš”í•œ ê²½ìš°, middlewareëŠ” `action_requests`ì™€ `review_configs`ê°€ í¬í•¨ëœ `HITLRequest`ë¥¼ ë¹Œë“œí•˜ê³  [interrupt](https://langchain-ai.github.io/langgraphjs/reference/functions/langgraph.interrupt-2.html)ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
4. ì—ì´ì „íŠ¸ê°€ ì‚¬ëŒì˜ ê²°ì •ì„ ê¸°ë‹¤ë¦½ë‹ˆë‹¤.
5. `HITLResponse` ê²°ì •ì— ë”°ë¼, middlewareëŠ” ìŠ¹ì¸ë˜ê±°ë‚˜ í¸ì§‘ëœ í˜¸ì¶œì„ ì‹¤í–‰í•˜ê³ , ê±°ë¶€ëœ í˜¸ì¶œì— ëŒ€í•œ @[ToolMessage]ë¥¼ í•©ì„±í•˜ë©°, ì‹¤í–‰ì„ ì¬ê°œí•©ë‹ˆë‹¤.



## ì‚¬ìš©ì ì •ì˜ HITL ë¡œì§

ë” ì „ë¬¸í™”ëœ ì›Œí¬í”Œë¡œìš°ì˜ ê²½ìš°, [interrupt](https://langchain-ai.github.io/langgraphjs/reference/functions/langgraph.interrupt-2.html) primitiveì™€ [middleware](/oss/javascript/langchain/middleware) ì¶”ìƒí™”ë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ì ì •ì˜ HITL ë¡œì§ì„ êµ¬ì¶•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

Interruptë¥¼ ì—ì´ì „íŠ¸ì˜ ì‘ì—…ì— í†µí•©í•˜ëŠ” ë°©ë²•ì„ ì´í•´í•˜ë ¤ë©´ ìœ„ì˜ [ì‹¤í–‰ ìƒëª…ì£¼ê¸°](#execution-lifecycle)ë¥¼ ê²€í† í•˜ì„¸ìš”.

---

<Callout icon="pen-to-square" iconType="regular">
    [Edit the source of this page on GitHub.](https://github.com/langchain-ai/docs/edit/main/src/oss/langchain/human-in-the-loop.mdx)
</Callout>
<Tip icon="terminal" iconType="regular">
    [Connect these docs programmatically](/use-these-docs) to Claude, VSCode, and more via MCP for    real-time answers.
</Tip>
