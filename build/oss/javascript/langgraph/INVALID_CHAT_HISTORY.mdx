---
title: INVALID_CHAT_HISTORY
---





이 오류는 prebuilt @[createAgent][create_agent]에서 `callModel` graph node가 잘못된 형식의 메시지 목록을 받을 때 발생합니다. 구체적으로, `tool_calls`를 가진 `AIMessage`들 (LLM이 도구 호출을 요청함)이 있지만 해당하는 @[`ToolMessage`] (LLM에 반환할 도구 호출 결과)가 없을 때 잘못된 형식입니다.


이 오류가 발생하는 몇 가지 이유가 있을 수 있습니다:



1. graph를 호출할 때 수동으로 잘못된 형식의 메시지 목록을 전달한 경우, 예: `graph.invoke({messages: [new AIMessage({..., tool_calls: [...]})]})`
2. `tools` node로부터 업데이트(@[`ToolMessage`] 목록)를 받기 전에 graph가 중단되었고,
  null이나 ToolMessage가 아닌 입력으로 호출한 경우,
  예: `graph.invoke({messages: [new HumanMessage(...)]}, config)`.
  이 중단은 다음 방법 중 하나로 트리거될 수 있습니다:
  * `createAgent`에서 수동으로 `interruptBefore: ['tools']`를 설정한 경우
  * 도구 중 하나가 [`ToolNode`](https://reference.langchain.com/javascript/classes/langchain.index.ToolNode.html) (`"tools"`)에서 처리되지 않은 오류를 발생시킨 경우


## Troubleshooting

이 문제를 해결하려면 다음 중 하나를 수행할 수 있습니다:

1. 잘못된 형식의 메시지 목록으로 graph를 호출하지 마세요
2. 중단(수동 또는 오류로 인한)의 경우 다음을 수행할 수 있습니다:



* 기존 tool call과 일치하는 `ToolMessage` 객체를 제공하고 `graph.invoke({messages: [new ToolMessage(...)]})`를 호출합니다.
  **참고**: 이렇게 하면 메시지가 히스토리에 추가되고 START node부터 graph가 실행됩니다.
  * 수동으로 state를 업데이트하고 중단 지점부터 graph를 재개합니다:
    1. `graph.getState(config)`로 graph state에서 가장 최근 메시지 목록을 가져옵니다
    2. 메시지 목록을 수정하여 AIMessages에서 응답되지 않은 tool call을 제거하거나

응답되지 않은 tool call과 일치하는 `toolCallId`를 가진 `ToolMessage` 객체를 추가합니다 3. 수정된 메시지 목록으로 `graph.updateState(config, {messages: ...})`를 호출합니다 4. graph를 재개합니다, 예: `graph.invoke(null, config)`를 호출합니다

---

<Callout icon="pen-to-square" iconType="regular">
    [Edit the source of this page on GitHub.](https://github.com/langchain-ai/docs/edit/main/src/oss/langgraph/INVALID_CHAT_HISTORY.mdx)
</Callout>
<Tip icon="terminal" iconType="regular">
    [Connect these docs programmatically](/use-these-docs) to Claude, VSCode, and more via MCP for    real-time answers.
</Tip>
