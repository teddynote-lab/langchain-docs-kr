---
title: MCP Server
---
<Tip>
Open Agent Platform은 Streamable HTTP 요청을 지원하는 MCP server에만 연결을 지원합니다. **2025년 5월 10일** 기준으로, 이를 지원하는 MCP server가 많지 않기 때문에 [Arcade](https://arcade-ai.com/)의 MCP server에 연결된 데모 애플리케이션을 출시했습니다.
</Tip>

Open Agent Platform은 Streamable HTTP 요청을 지원하는 MCP server에 agent를 연결하는 것을 최우선으로 지원하도록 구축되었습니다. MCP server는 두 가지 방법 중 하나로 구성할 수 있습니다.

먼저, `apps/web/` 디렉토리 내의 환경 변수 `NEXT_PUBLIC_MCP_SERVER_URL`에 MCP server URL을 설정하세요. 이 URL은 `/mcp`로 끝나지 *않아야* 합니다. OAP 웹 앱이 MCP server에 요청을 보낼 때 URL에 이를 추가하기 때문입니다.

예를 들어, MCP server URL이 다음과 같다면:

```bash
https://api.arcade.dev/v1/mcps/arcade-anon/mcp
```

환경 변수는 다음과 같이 설정해야 합니다:

```bash
NEXT_PUBLIC_MCP_SERVER_URL="https://api.arcade.dev/v1/mcps/arcade-anon" # no /mcp
```

### 인증이 필요한 Server

인증이 필요한 MCP server에 연결하려면 `NEXT_PUBLIC_MCP_AUTH_REQUIRED=true`로 설정해야 합니다. MCP 인증은 다음과 같이 작동합니다:

웹 클라이언트가 proxy route(`/api/oap_mcp`)에 요청을 보냅니다. 이 API route 내부에서 Supabase의 JWT를 사용하여 MCP server와 인증합니다. 즉, MCP server에 Supabase JWT(또는 다른 인증 제공자를 사용하기로 선택한 경우 다른 JWT)를 MCP access token으로 교환할 수 있는 endpoint를 구현해야 합니다. 이 access token은 MCP server에 대한 요청을 인증하는 데 사용됩니다. 이 교환 후, MCP access token을 사용하여 사용자를 대신하여 MCP server에 요청을 보내며, 요청의 `Authorization` header를 통해 전달합니다. 요청 응답을 클라이언트에 다시 보낼 때, 응답의 `x-mcp-access-token` header에 MCP access token을 포함합니다. 이를 통해 클라이언트는 매번 MCP server와 인증할 필요 없이 향후 MCP server에 대한 요청에서 MCP access token을 사용할 수 있습니다. 기본적으로 1시간 후에 만료되도록 설정됩니다.

`NEXT_PUBLIC_MCP_SERVER_URL`에 설정된 URL은 proxy route가 MCP server에 요청을 보내기 위해 끝에 `/mcp`를 추가하고, MCP server의 OAuth token endpoint에 요청을 보내기 위해 끝에 `/oauth/token`을 추가할 수 있도록 형식화되어야 합니다.

선택적으로, `MCP_TOKENS` 환경 변수를 `access_token` 필드를 포함하는 객체로 설정할 수 있습니다. 이 환경 변수가 설정되면, 해당 access token을 사용하여 MCP server에 대한 요청을 인증하려고 시도합니다. 이는 테스트에 유용하거나 Supabase가 아닌 다른 인증 제공자를 사용하려는 경우에 유용합니다.

### 인증이 필요하지 않은 Server

인증이 필요하지 않은 MCP server에 연결하려면 `NEXT_PUBLIC_MCP_SERVER_URL` 환경 변수를 MCP server의 URL로 설정해야 합니다. 이 URL이 설정되고 `NEXT_PUBLIC_MCP_AUTH_REQUIRED`가 설정되지 않았거나 `true`로 설정되지 않은 경우, proxy route에서 OAuth 요청을 실행하지 않고 대신 MCP server를 직접 호출합니다.

### MCP Server URL 변경

MCP server URL을 변경하는 경우, 모든 agent를 업데이트하여 새 URL을 사용하도록 해야 합니다. 이를 위한 스크립트가 이 repo에 포함되어 있습니다. 이 스크립트는 [`apps/web/scripts/update-agents-mcp-url.ts`](https://github.com/langchain-ai/open-agent-platform/blob/main/apps/web/scripts/update-agents-mcp-url.ts)에서 찾을 수 있습니다.

agent의 MCP server URL을 업데이트하려면, 최신 MCP server URL이 환경 변수 `NEXT_PUBLIC_MCP_SERVER_URL`에 설정되어 있는지 확인하고, `NEXT_PUBLIC_DEPLOYMENTS`에 배포가 설정되어 있는지, 그리고 `LANGSMITH_API_KEY`에 LangSmith API key가 설정되어 있는지 확인하세요(스크립트가 LangSmith auth를 사용하여 LangGraph server와 인증하고 사용자 인증을 우회하기 때문입니다). 그런 다음 스크립트를 실행하세요:

```bash
# Ensure you're inside the `apps/web` directory
cd apps/web

# Run the script via TSX.
npx tsx scripts/update-agents-mcp-url.ts
```

이렇게 하면 나열된 모든 배포에서 모든 agent를 가져옵니다. 그런 다음 주어진 agent가 MCP server를 지원하는지 확인합니다. 지원하는 경우 MCP server URL이 이미 새 URL로 설정되어 있지 않은지 확인합니다. 설정되어 있지 않으면 agent의 config를 업데이트하여 새 URL을 사용하도록 합니다.