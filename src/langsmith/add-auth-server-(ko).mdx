---
title: ì¸ì¦ ì œê³µì ì—°ê²°í•˜ê¸°
sidebarTitle: ì¸ì¦ ì œê³µì ì—°ê²°í•˜ê¸°
---
[ì´ì „ íŠœí† ë¦¬ì–¼](/langsmith/resource-auth)ì—ì„œëŠ” ì‚¬ìš©ìì—ê²Œ ë¹„ê³µê°œ ëŒ€í™”ë¥¼ ì œê³µí•˜ê¸° ìœ„í•´ ë¦¬ì†ŒìŠ¤ ê¶Œí•œ ë¶€ì—¬ë¥¼ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì—¬ì „íˆ í•˜ë“œì½”ë”©ëœ í† í°ì„ ì¸ì¦ì— ì‚¬ìš©í•˜ê³  ìˆì–´ ì•ˆì „í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ì œ [OAuth2](/langsmith/deployment-quickstart)ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹¤ì œ ì‚¬ìš©ì ê³„ì •ìœ¼ë¡œ í•´ë‹¹ í† í°ì„ êµì²´í•˜ê² ìŠµë‹ˆë‹¤.

ë™ì¼í•œ [`Auth`](/langsmith/langgraph-python-sdk#langgraph_sdk.auth.Auth) ê°ì²´ì™€ [ë¦¬ì†ŒìŠ¤ ìˆ˜ì¤€ ì ‘ê·¼ ì œì–´](/langsmith/auth#single-owner-resources)ë¥¼ ìœ ì§€í•˜ë˜, Supabaseë¥¼ identity providerë¡œ ì‚¬ìš©í•˜ë„ë¡ ì¸ì¦ì„ ì—…ê·¸ë ˆì´ë“œí•©ë‹ˆë‹¤. ì´ íŠœí† ë¦¬ì–¼ì—ì„œëŠ” Supabaseë¥¼ ì‚¬ìš©í•˜ì§€ë§Œ, ê°œë…ì€ ëª¨ë“  OAuth2 ì œê³µìì— ì ìš©ë©ë‹ˆë‹¤. ë‹¤ìŒ ë‚´ìš©ì„ ë°°ìš°ê²Œ ë©ë‹ˆë‹¤:

1. í…ŒìŠ¤íŠ¸ í† í°ì„ ì‹¤ì œ JWT í† í°ìœ¼ë¡œ êµì²´í•˜ê¸°
2. ì•ˆì „í•œ ì‚¬ìš©ì ì¸ì¦ì„ ìœ„í•´ OAuth2 ì œê³µìì™€ í†µí•©í•˜ê¸°
3. ê¸°ì¡´ ê¶Œí•œ ë¶€ì—¬ ë¡œì§ì„ ìœ ì§€í•˜ë©´ì„œ ì‚¬ìš©ì ì„¸ì…˜ ë° ë©”íƒ€ë°ì´í„° ì²˜ë¦¬í•˜ê¸°

## ë°°ê²½

OAuth2ëŠ” ì„¸ ê°€ì§€ ì£¼ìš” ì—­í• ì„ í¬í•¨í•©ë‹ˆë‹¤:

1. **Authorization server**: ì‚¬ìš©ì ì¸ì¦ì„ ì²˜ë¦¬í•˜ê³  í† í°ì„ ë°œê¸‰í•˜ëŠ” identity provider (ì˜ˆ: Supabase, Auth0, Google)
2. **Application backend**: LangGraph ì• í”Œë¦¬ì¼€ì´ì…˜. í† í°ì„ ê²€ì¦í•˜ê³  ë³´í˜¸ëœ ë¦¬ì†ŒìŠ¤(ëŒ€í™” ë°ì´í„°)ë¥¼ ì œê³µí•©ë‹ˆë‹¤
3. **Client application**: ì‚¬ìš©ìê°€ ì„œë¹„ìŠ¤ì™€ ìƒí˜¸ì‘ìš©í•˜ëŠ” ì›¹ ë˜ëŠ” ëª¨ë°”ì¼ ì•±

í‘œì¤€ OAuth2 íë¦„ì€ ë‹¤ìŒê³¼ ê°™ì´ ì‘ë™í•©ë‹ˆë‹¤:

```mermaid
sequenceDiagram
    participant User
    participant Client
    participant AuthServer
    participant LangGraph Backend

    User->>Client: Initiate login
    User->>AuthServer: Enter credentials
    AuthServer->>Client: Send tokens
    Client->>LangGraph Backend: Request with token
    LangGraph Backend->>AuthServer: Validate token
    AuthServer->>LangGraph Backend: Token valid
    LangGraph Backend->>Client: Serve request (e.g., run agent or graph)
```

## ì‚¬ì „ ìš”êµ¬ì‚¬í•­

ì´ íŠœí† ë¦¬ì–¼ì„ ì‹œì‘í•˜ê¸° ì „ì— ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”:

* [ë‘ ë²ˆì§¸ íŠœí† ë¦¬ì–¼ì˜ ë´‡](/langsmith/resource-auth)ì´ ì˜¤ë¥˜ ì—†ì´ ì‹¤í–‰ë˜ê³  ìˆì–´ì•¼ í•©ë‹ˆë‹¤.
* ì¸ì¦ ì„œë²„ë¡œ ì‚¬ìš©í•  [Supabase í”„ë¡œì íŠ¸](https://supabase.com/dashboard)ê°€ í•„ìš”í•©ë‹ˆë‹¤.

## 1. ì˜ì¡´ì„± ì„¤ì¹˜

í•„ìš”í•œ ì˜ì¡´ì„±ì„ ì„¤ì¹˜í•©ë‹ˆë‹¤. `custom-auth` ë””ë ‰í† ë¦¬ì—ì„œ ì‹œì‘í•˜ê³  `langgraph-cli`ê°€ ì„¤ì¹˜ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”:

<CodeGroup>
```bash pip
cd custom-auth
pip install -U "langgraph-cli[inmem]"
```

```bash uv
cd custom-auth
uv add langgraph-cli[inmem]
```
</CodeGroup>

<a id="setup-auth-provider"></a>
## 2. ì¸ì¦ ì œê³µì ì„¤ì •

ë‹¤ìŒìœ¼ë¡œ ì¸ì¦ ì„œë²„ì˜ URLê³¼ ì¸ì¦ì„ ìœ„í•œ private keyë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
Supabaseë¥¼ ì‚¬ìš©í•˜ê³  ìˆìœ¼ë¯€ë¡œ Supabase ëŒ€ì‹œë³´ë“œì—ì„œ ì´ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

1. ì™¼ìª½ ì‚¬ì´ë“œë°”ì—ì„œ âš™ï¸ "Project Settings"ë¥¼ í´ë¦­í•œ ë‹¤ìŒ "API"ë¥¼ í´ë¦­í•©ë‹ˆë‹¤
2. í”„ë¡œì íŠ¸ URLì„ ë³µì‚¬í•˜ì—¬ `.env` íŒŒì¼ì— ì¶”ê°€í•©ë‹ˆë‹¤
  ```shell
  echo "SUPABASE_URL=your-project-url" >> .env
  ```
3. service role secret keyë¥¼ ë³µì‚¬í•˜ì—¬ `.env` íŒŒì¼ì— ì¶”ê°€í•©ë‹ˆë‹¤:
  ```shell
  echo "SUPABASE_SERVICE_KEY=your-service-role-key" >> .env
  ```
4. "anon public" keyë¥¼ ë³µì‚¬í•˜ì—¬ ê¸°ë¡í•´ ë‘¡ë‹ˆë‹¤. ì´ëŠ” ë‚˜ì¤‘ì— í´ë¼ì´ì–¸íŠ¸ ì½”ë“œë¥¼ ì„¤ì •í•  ë•Œ ì‚¬ìš©ë©ë‹ˆë‹¤.
  ```bash
  SUPABASE_URL=your-project-url
  SUPABASE_SERVICE_KEY=your-service-role-key
  ```

## 3. í† í° ê²€ì¦ êµ¬í˜„

ì´ì „ íŠœí† ë¦¬ì–¼ì—ì„œëŠ” [`Auth`](/langsmith/langgraph-python-sdk#langgraph_sdk.auth.Auth) ê°ì²´ë¥¼ ì‚¬ìš©í•˜ì—¬ [í•˜ë“œì½”ë”©ëœ í† í°ì„ ê²€ì¦](/langsmith/set-up-custom-auth)í•˜ê³  [ë¦¬ì†ŒìŠ¤ ì†Œìœ ê¶Œì„ ì¶”ê°€](/langsmith/resource-auth)í–ˆìŠµë‹ˆë‹¤.

ì´ì œ Supabaseì˜ ì‹¤ì œ JWT í† í°ì„ ê²€ì¦í•˜ë„ë¡ ì¸ì¦ì„ ì—…ê·¸ë ˆì´ë“œí•©ë‹ˆë‹¤. ì£¼ìš” ë³€ê²½ ì‚¬í•­ì€ ëª¨ë‘ [`@auth.authenticate`](/langsmith/langgraph-python-sdk#langgraph_sdk.auth.Auth.authenticate) ë°ì½”ë ˆì´í„°ê°€ ì ìš©ëœ í•¨ìˆ˜ì— ìˆìŠµë‹ˆë‹¤:

* í•˜ë“œì½”ë”©ëœ í† í° ëª©ë¡ì„ í™•ì¸í•˜ëŠ” ëŒ€ì‹  Supabaseì— HTTP ìš”ì²­ì„ ë³´ë‚´ í† í°ì„ ê²€ì¦í•©ë‹ˆë‹¤.
* ê²€ì¦ëœ í† í°ì—ì„œ ì‹¤ì œ ì‚¬ìš©ì ì •ë³´(ID, ì´ë©”ì¼)ë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤.
* ê¸°ì¡´ ë¦¬ì†ŒìŠ¤ ê¶Œí•œ ë¶€ì—¬ ë¡œì§ì€ ë³€ê²½ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

ì´ë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•´ `src/security/auth.py`ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤:

```python {highlight={8-9,20-30}} title="src/security/auth.py"
import os
import httpx
from langgraph_sdk import Auth

auth = Auth()

# This is loaded from the `.env` file you created above
SUPABASE_URL = os.environ["SUPABASE_URL"]
SUPABASE_SERVICE_KEY = os.environ["SUPABASE_SERVICE_KEY"]


@auth.authenticate
async def get_current_user(authorization: str | None):
    """Validate JWT tokens and extract user information."""
    assert authorization
    scheme, token = authorization.split()
    assert scheme.lower() == "bearer"

    try:
        # Verify token with auth provider
        async with httpx.AsyncClient() as client:
            response = await client.get(
                f"{SUPABASE_URL}/auth/v1/user",
                headers={
                    "Authorization": authorization,
                    "apiKey": SUPABASE_SERVICE_KEY,
                },
            )
            assert response.status_code == 200
            user = response.json()
            return {
                "identity": user["id"],  # Unique user identifier
                "email": user["email"],
                "is_authenticated": True,
            }
    except Exception as e:
        raise Auth.exceptions.HTTPException(status_code=401, detail=str(e))

# ... the rest is the same as before

# Keep our resource authorization from the previous tutorial
@auth.on
async def add_owner(ctx, value):
    """Make resources private to their creator using resource metadata."""
    filters = {"owner": ctx.user.identity}
    metadata = value.setdefault("metadata", {})
    metadata.update(filters)
    return filters
```

ê°€ì¥ ì¤‘ìš”í•œ ë³€ê²½ ì‚¬í•­ì€ ì´ì œ ì‹¤ì œ ì¸ì¦ ì„œë²„ë¡œ í† í°ì„ ê²€ì¦í•œë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ì¸ì¦ í•¸ë“¤ëŸ¬ëŠ” Supabase í”„ë¡œì íŠ¸ì˜ private keyë¥¼ ê°€ì§€ê³  ìˆìœ¼ë©°, ì´ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ìì˜ í† í°ì„ ê²€ì¦í•˜ê³  ì •ë³´ë¥¼ ì¶”ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## 4. ì¸ì¦ íë¦„ í…ŒìŠ¤íŠ¸

ìƒˆë¡œìš´ ì¸ì¦ íë¦„ì„ í…ŒìŠ¤íŠ¸í•´ ë´…ì‹œë‹¤. íŒŒì¼ì´ë‚˜ ë…¸íŠ¸ë¶ì—ì„œ ë‹¤ìŒ ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒì„ ì œê³µí•´ì•¼ í•©ë‹ˆë‹¤:

* ìœ íš¨í•œ ì´ë©”ì¼ ì£¼ì†Œ
* Supabase í”„ë¡œì íŠ¸ URL ([ìœ„](#setup-auth-provider)ì—ì„œ ê°€ì ¸ì˜´)
* Supabase anon **public key** ([ìœ„](#setup-auth-provider)ì—ì„œ ê°€ì ¸ì˜´)

```python
import os
import httpx
from getpass import getpass
from langgraph_sdk import get_client


# Get email from command line
email = getpass("Enter your email: ")
base_email = email.split("@")
password = "secure-password"  # CHANGEME
email1 = f"{base_email[0]}+1@{base_email[1]}"
email2 = f"{base_email[0]}+2@{base_email[1]}"

SUPABASE_URL = os.environ.get("SUPABASE_URL")
if not SUPABASE_URL:
    SUPABASE_URL = getpass("Enter your Supabase project URL: ")

# This is your PUBLIC anon key (which is safe to use client-side)
# Do NOT mistake this for the secret service role key
SUPABASE_ANON_KEY = os.environ.get("SUPABASE_ANON_KEY")
if not SUPABASE_ANON_KEY:
    SUPABASE_ANON_KEY = getpass("Enter your public Supabase anon  key: ")


async def sign_up(email: str, password: str):
    """Create a new user account."""
    async with httpx.AsyncClient() as client:
        response = await client.post(
            f"{SUPABASE_URL}/auth/v1/signup",
            json={"email": email, "password": password},
            headers={"apiKey": SUPABASE_ANON_KEY},
        )
        assert response.status_code == 200
        return response.json()

# Create two test users
print(f"Creating test users: {email1} and {email2}")
await sign_up(email1, password)
await sign_up(email2, password)
```

âš ï¸ ê³„ì†í•˜ê¸° ì „ì—: ì´ë©”ì¼ì„ í™•ì¸í•˜ê³  ë‘ í™•ì¸ ë§í¬ë¥¼ ëª¨ë‘ í´ë¦­í•˜ì„¸ìš”. SupabaseëŠ” ì‚¬ìš©ìì˜ ì´ë©”ì¼ì„ í™•ì¸í•œ í›„ì—ë§Œ `/login` ìš”ì²­ì„ ìˆ˜ë½í•©ë‹ˆë‹¤.

ì´ì œ ì‚¬ìš©ìê°€ ìì‹ ì˜ ë°ì´í„°ë§Œ ë³¼ ìˆ˜ ìˆëŠ”ì§€ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤. ê³„ì†í•˜ê¸° ì „ì— ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”(`langgraph dev` ì‹¤í–‰). ë‹¤ìŒ ìŠ¤ë‹ˆí«ì€ [ì¸ì¦ ì œê³µì ì„¤ì •](#setup-auth-provider) ì¤‘ì— Supabase ëŒ€ì‹œë³´ë“œì—ì„œ ë³µì‚¬í•œ "anon public" keyê°€ í•„ìš”í•©ë‹ˆë‹¤.

```python
async def login(email: str, password: str):
    """Get an access token for an existing user."""
    async with httpx.AsyncClient() as client:
        response = await client.post(
            f"{SUPABASE_URL}/auth/v1/token?grant_type=password",
            json={
                "email": email,
                "password": password
            },
            headers={
                "apikey": SUPABASE_ANON_KEY,
                "Content-Type": "application/json"
            },
        )
        assert response.status_code == 200
        return response.json()["access_token"]


# Log in as user 1
user1_token = await login(email1, password)
user1_client = get_client(
    url="http://localhost:2024", headers={"Authorization": f"Bearer {user1_token}"}
)

# Create a thread as user 1
thread = await user1_client.threads.create()
print(f"âœ… User 1 created thread: {thread['thread_id']}")

# Try to access without a token
unauthenticated_client = get_client(url="http://localhost:2024")
try:
    await unauthenticated_client.threads.create()
    print("âŒ Unauthenticated access should fail!")
except Exception as e:
    print("âœ… Unauthenticated access blocked:", e)

# Try to access user 1's thread as user 2
user2_token = await login(email2, password)
user2_client = get_client(
    url="http://localhost:2024", headers={"Authorization": f"Bearer {user2_token}"}
)

try:
    await user2_client.threads.get(thread["thread_id"])
    print("âŒ User 2 shouldn't see User 1's thread!")
except Exception as e:
    print("âœ… User 2 blocked from User 1's thread:", e)
```

ì¶œë ¥ì€ ë‹¤ìŒê³¼ ê°™ì•„ì•¼ í•©ë‹ˆë‹¤:

```shell
âœ… User 1 created thread: d6af3754-95df-4176-aa10-dbd8dca40f1a
âœ… Unauthenticated access blocked: Client error '403 Forbidden' for url 'http://localhost:2024/threads'
âœ… User 2 blocked from User 1's thread: Client error '404 Not Found' for url 'http://localhost:2024/threads/d6af3754-95df-4176-aa10-dbd8dca40f1a'
```

ì¸ì¦ê³¼ ê¶Œí•œ ë¶€ì—¬ê°€ í•¨ê»˜ ì‘ë™í•˜ê³  ìˆìŠµë‹ˆë‹¤:

1. ì‚¬ìš©ìëŠ” ë´‡ì— ì•¡ì„¸ìŠ¤í•˜ë ¤ë©´ ë¡œê·¸ì¸í•´ì•¼ í•©ë‹ˆë‹¤
2. ê° ì‚¬ìš©ìëŠ” ìì‹ ì˜ threadë§Œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤

ëª¨ë“  ì‚¬ìš©ìëŠ” Supabase ì¸ì¦ ì œê³µìì— ì˜í•´ ê´€ë¦¬ë˜ë¯€ë¡œ ì¶”ê°€ ì‚¬ìš©ì ê´€ë¦¬ ë¡œì§ì„ êµ¬í˜„í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.

## ë‹¤ìŒ ë‹¨ê³„

LangGraph ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìœ„í•œ í”„ë¡œë•ì…˜ ì¤€ë¹„ ì¸ì¦ ì‹œìŠ¤í…œì„ ì„±ê³µì ìœ¼ë¡œ êµ¬ì¶•í–ˆìŠµë‹ˆë‹¤! ë‹¬ì„±í•œ ë‚´ìš©ì„ ê²€í† í•´ ë´…ì‹œë‹¤:

1. ì¸ì¦ ì œê³µì ì„¤ì • (ì´ ê²½ìš° Supabase)
2. ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ ì¸ì¦ì„ ì‚¬ìš©í•œ ì‹¤ì œ ì‚¬ìš©ì ê³„ì • ì¶”ê°€
3. LangGraph ì„œë²„ì— JWT í† í° ê²€ì¦ í†µí•©
4. ì‚¬ìš©ìê°€ ìì‹ ì˜ ë°ì´í„°ë§Œ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆë„ë¡ ì ì ˆí•œ ê¶Œí•œ ë¶€ì—¬ êµ¬í˜„
5. ë‹¤ìŒ ì¸ì¦ ê³¼ì œë¥¼ ì²˜ë¦¬í•  ì¤€ë¹„ê°€ ëœ ê¸°ë°˜ êµ¬ì¶• ğŸš€

ì´ì œ í”„ë¡œë•ì…˜ ì¸ì¦ì„ ê°–ì¶”ì—ˆìœ¼ë¯€ë¡œ ë‹¤ìŒì„ ê³ ë ¤í•´ ë³´ì„¸ìš”:

1. ì„ í˜¸í•˜ëŠ” í”„ë ˆì„ì›Œí¬ë¡œ ì›¹ UI êµ¬ì¶• (ì˜ˆì œëŠ” [Custom Auth](https://github.com/langchain-ai/custom-auth) í…œí”Œë¦¿ ì°¸ì¡°)
2. [ì¸ì¦ì— ëŒ€í•œ ê°œë… ê°€ì´ë“œ](/langsmith/auth)ì—ì„œ ì¸ì¦ ë° ê¶Œí•œ ë¶€ì—¬ì˜ ë‹¤ë¥¸ ì¸¡ë©´ì— ëŒ€í•´ ìì„¸íˆ ì•Œì•„ë³´ê¸°
3. [ì°¸ì¡° ë¬¸ì„œ](/langsmith/langgraph-python-sdk#langgraph_sdk.auth.Auth)ë¥¼ ì½ì€ í›„ í•¸ë“¤ëŸ¬ì™€ ì„¤ì •ì„ ì¶”ê°€ë¡œ ì‚¬ìš©ì ì •ì˜í•˜ê¸°