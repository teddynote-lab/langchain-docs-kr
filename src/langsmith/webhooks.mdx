---
title: ruleì— ëŒ€í•œ webhook ì•Œë¦¼ êµ¬ì„±í•˜ê¸°
sidebarTitle: ruleì— ëŒ€í•œ webhook ì•Œë¦¼ êµ¬ì„±í•˜ê¸°
---

automation actionì— webhook URLì„ ì¶”ê°€í•˜ë©´, ì •ì˜í•œ ruleê³¼ ì¼ì¹˜í•˜ëŠ” ìƒˆë¡œìš´ runì´ ìˆì„ ë•Œë§ˆë‹¤ webhook endpointë¡œ POST ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤.

![](/langsmith/images/webhook.png)

## Webhook payload

webhook endpointë¡œ ì „ì†¡í•˜ëŠ” payloadì—ëŠ” ë‹¤ìŒì´ í¬í•¨ë©ë‹ˆë‹¤:

- `"rule_id"`: ì´ payloadë¥¼ ì „ì†¡í•œ automationì˜ IDì…ë‹ˆë‹¤
- `"start_time"` ë° `"end_time"`: ì¼ì¹˜í•˜ëŠ” runì„ ì°¾ì€ ì‹œê°„ ë²”ìœ„ì…ë‹ˆë‹¤
- `"runs"`: runì˜ ë°°ì—´ì´ë©°, ê° runì€ dictionaryì…ë‹ˆë‹¤. ê° runì— ëŒ€í•œ ë” ë§ì€ ì •ë³´ê°€ í•„ìš”í•œ ê²½ìš° endpointì—ì„œ SDKë¥¼ ì‚¬ìš©í•˜ì—¬ APIì—ì„œ ê°€ì ¸ì˜¤ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.
- `"feedback_stats"`: runì— ëŒ€í•œ í”¼ë“œë°± í†µê³„ê°€ í¬í•¨ëœ dictionaryì…ë‹ˆë‹¤. ì´ í•„ë“œì˜ ì˜ˆì‹œ payloadëŠ” ì•„ë˜ì— í‘œì‹œë˜ì–´ ìˆìŠµë‹ˆë‹¤.

```json
"feedback_stats": {
    "about_langchain": {
        "n": 1,
        "avg": 0.0,
        "show_feedback_arrow": true,
        "values": {}
    },
    "category": {
        "n": 0,
        "avg": null,
        "show_feedback_arrow": true,
        "values": {
            "CONCEPTUAL": 1
        }
    },
    "user_score": {
        "n": 2,
        "avg": 0.0,
        "show_feedback_arrow": false,
        "values": {}
    },
    "vagueness": {
        "n": 1,
        "avg": 0.0,
        "show_feedback_arrow": true,
        "values": {}
    }
}
```

<Note>
**S3 URLì—ì„œ ê°€ì ¸ì˜¤ê¸°**

runì´ ì–¼ë§ˆë‚˜ ìµœê·¼ì¸ì§€ì— ë”°ë¼ `inputs_s3_urls` ë° `outputs_s3_urls` í•„ë“œì— ë°ì´í„° ìì²´ ëŒ€ì‹  ì‹¤ì œ ë°ì´í„°ì— ëŒ€í•œ S3 URLì´ í¬í•¨ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

`inputs` ë° `outputs`ëŠ” ê°ê° `inputs_s3_urls` ë° `outputs_s3_urls`ì— ì œê³µëœ `ROOT.presigned_url`ì„ í†µí•´ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
</Note>

ë‹¤ìŒì€ webhook endpointë¡œ ì „ì†¡í•˜ëŠ” ì „ì²´ payloadì˜ ì˜ˆì‹œì…ë‹ˆë‹¤:

```json
{
  "rule_id": "d75d7417-0c57-4655-88fe-1db3cda3a47a",
  "start_time": "2024-04-05T01:28:54.734491+00:00",
  "end_time": "2024-04-05T01:28:56.492563+00:00",
  "runs": [
    {
      "status": "success",
      "is_root": true,
      "trace_id": "6ab80f10-d79c-4fa2-b441-922ed6feb630",
      "dotted_order": "20230505T051324571809Z6ab80f10-d79c-4fa2-b441-922ed6feb630",
      "run_type": "tool",
      "modified_at": "2024-04-05T01:28:54.145062",
      "tenant_id": "2ebda79f-2946-4491-a9ad-d642f49e0815",
      "end_time": "2024-04-05T01:28:54.085649",
      "name": "Search",
      "start_time": "2024-04-05T01:28:54.085646",
      "id": "6ab80f10-d79c-4fa2-b441-922ed6feb630",
      "session_id": "6a3be6a2-9a8c-4fc8-b4c6-a8983b286cc5",
      "parent_run_ids": [],
      "child_run_ids": null,
      "direct_child_run_ids": null,
      "total_tokens": 0,
      "completion_tokens": 0,
      "prompt_tokens": 0,
      "total_cost": null,
      "completion_cost": null,
      "prompt_cost": null,
      "first_token_time": null,
      "app_path": "/o/2ebda79f-2946-4491-a9ad-d642f49e0815/projects/p/6a3be6a2-9a8c-4fc8-b4c6-a8983b286cc5/r/6ab80f10-d79c-4fa2-b441-922ed6feb630?trace_id=6ab80f10-d79c-4fa2-b441-922ed6feb630&start_time=2023-05-05T05:13:24.571809",
      "in_dataset": false,
      "last_queued_at": null,
      "inputs": null,
      "inputs_s3_urls": null,
      "outputs": null,
      "outputs_s3_urls": null,
      "extra": null,
      "events": null,
      "feedback_stats": null,
      "serialized": null,
      "share_token": null
    }
  ]
}
```

## Security

webhook URLì— secret query string parameterë¥¼ ì¶”ê°€í•˜ê³  ë“¤ì–´ì˜¤ëŠ” ëª¨ë“  ìš”ì²­ì—ì„œ ì´ë¥¼ í™•ì¸í•˜ëŠ” ê²ƒì„ ê°•ë ¥íˆ ê¶Œì¥í•©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ëˆ„êµ°ê°€ webhook URLì„ ë°œê²¬í•˜ë”ë¼ë„ í•´ë‹¹ í˜¸ì¶œì„ ì‹¤ì œ webhook ì•Œë¦¼ê³¼ êµ¬ë³„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì˜ˆì‹œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤

```
https://api.example.com/langsmith_webhook?secret=38ee77617c3a489ab6e871fbeb2ec87d
```

### Webhook custom HTTP headers

webhookê³¼ í•¨ê»˜ íŠ¹ì • headerë¥¼ ì „ì†¡í•˜ë ¤ë©´ URLë³„ë¡œ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ ì„¤ì •í•˜ë ¤ë©´ URL í•„ë“œ ì˜†ì˜ `Headers` ì˜µì…˜ì„ í´ë¦­í•˜ê³  headerë¥¼ ì¶”ê°€í•˜ì„¸ìš”.

<Note>
HeaderëŠ” ì•”í˜¸í™”ëœ í˜•ì‹ìœ¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤.
</Note>

![](/langsmith/images/webhook-headers.png)

### Webhook Delivery

webhook endpointë¡œ ì´ë²¤íŠ¸ë¥¼ ì „ë‹¬í•  ë•Œ ë‹¤ìŒ ì§€ì¹¨ì„ ë”°ë¦…ë‹ˆë‹¤

- endpointì— ì—°ê²°í•˜ì§€ ëª»í•˜ë©´ ì „ë‹¬ ì‹¤íŒ¨ë¥¼ ì„ ì–¸í•˜ê¸° ì „ì— ì „ì†¡ ì—°ê²°ì„ ìµœëŒ€ 2ë²ˆê¹Œì§€ ì¬ì‹œë„í•©ë‹ˆë‹¤.
- endpointê°€ ì‘ë‹µí•˜ëŠ” ë° 5ì´ˆ ì´ìƒ ê±¸ë¦¬ë©´ ì „ë‹¬ ì‹¤íŒ¨ë¥¼ ì„ ì–¸í•˜ê³  ì¬ì‹œë„í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
- endpointê°€ 5ì´ˆ ì´ë‚´ì— 5xx ìƒíƒœ ì½”ë“œë¥¼ ë°˜í™˜í•˜ë©´ exponential backoffë¡œ ìµœëŒ€ 2ë²ˆê¹Œì§€ ì¬ì‹œë„í•©ë‹ˆë‹¤.
- endpointê°€ 4xx ìƒíƒœ ì½”ë“œë¥¼ ë°˜í™˜í•˜ë©´ ì „ë‹¬ ì‹¤íŒ¨ë¥¼ ì„ ì–¸í•˜ê³  ì¬ì‹œë„í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
- endpointê°€ bodyì— ë°˜í™˜í•˜ëŠ” ëª¨ë“  ë‚´ìš©ì€ ë¬´ì‹œë©ë‹ˆë‹¤

## Modalì„ ì‚¬ìš©í•œ ì˜ˆì‹œ

### Setup

ì„¤ì • ë°©ë²•ì˜ ì˜ˆì‹œë¡œ [Modal](https://modal.com/)ì„ ì‚¬ìš©í•˜ê² ìŠµë‹ˆë‹¤. Modalì€ ì¶”ë¡  ë° fine-tuningì„ ìœ„í•œ ìë™ í™•ì¥ GPU, code agentë¥¼ ìœ„í•œ ì•ˆì „í•œ ì»¨í…Œì´ë„ˆí™”, ê·¸ë¦¬ê³  serverless Python web endpointë¥¼ ì œê³µí•©ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” web endpointì— ì¤‘ì ì„ ë‘¡ë‹ˆë‹¤.

ë¨¼ì € Modal ê³„ì •ì„ ë§Œë“œì„¸ìš”. ê·¸ëŸ° ë‹¤ìŒ ë¡œì»¬ì— Modal SDKë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤:

<CodeGroup>
```bash pip
pip install modal
```

```bash uv
uv add modal
```
</CodeGroup>

ê³„ì • ì„¤ì •ì„ ì™„ë£Œí•˜ë ¤ë©´ ë‹¤ìŒ ëª…ë ¹ì„ ì‹¤í–‰í•˜ì„¸ìš”:

```shell
modal setup
```

ê·¸ë¦¬ê³  ì§€ì¹¨ì„ ë”°ë¥´ì„¸ìš”

### Secrets

ë‹¤ìŒìœ¼ë¡œ Modalì—ì„œ ì¼ë¶€ secretì„ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.

ë¨¼ì €, LangSmithëŠ” secretì„ ì „ë‹¬í•˜ì—¬ Modalì— ì¸ì¦í•´ì•¼ í•©ë‹ˆë‹¤.
ê°€ì¥ ì‰¬ìš´ ë°©ë²•ì€ query parameterì— secretì„ ì „ë‹¬í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.
ì´ secretì„ ê²€ì¦í•˜ë ¤ë©´ _Modal_ì— secretì„ ì¶”ê°€í•˜ì—¬ ê²€ì¦í•´ì•¼ í•©ë‹ˆë‹¤.
Modal secretì„ ìƒì„±í•˜ì—¬ ì´ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.
secretì— ëŒ€í•œ ì§€ì¹¨ì€ [ì—¬ê¸°](https://modal.com/docs/guide/secrets)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì´ ëª©ì ì„ ìœ„í•´ secretì„ `ls-webhook`ì´ë¼ê³  ë¶€ë¥´ê³  `LS_WEBHOOK`ì´ë¼ëŠ” ì´ë¦„ì˜ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì„¤ì •í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

LangSmith secretë„ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ - ë‹¤í–‰íˆ ì´ë¯¸ í†µí•© í…œí”Œë¦¿ì´ ìˆìŠµë‹ˆë‹¤!

![LangSmith Modal Template](/langsmith/images/modal-langsmith-secret.png)

### Service

ê·¸ í›„ endpoint ì—­í• ì„ í•  Python íŒŒì¼ì„ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì•„ë˜ëŠ” ë¬´ìŠ¨ ì¼ì´ ì¼ì–´ë‚˜ê³  ìˆëŠ”ì§€ ì„¤ëª…í•˜ëŠ” ì£¼ì„ì´ í¬í•¨ëœ ì˜ˆì‹œì…ë‹ˆë‹¤:

```python
from fastapi import HTTPException, status, Request, Query
from modal import Secret, Stub, web_endpoint, Image

stub = Stub("auth-example", image=Image.debian_slim().pip_install("langsmith"))


@stub.function(
    secrets=[Secret.from_name("ls-webhook"), Secret.from_name("my-langsmith-secret")]
)
# We want this to be a `POST` endpoint since we will post data here
@web_endpoint(method="POST")
# We set up a `secret` query parameter
def f(data: dict, secret: str = Query(...)):
    # You can import dependencies you don't have locally inside Modal functions
    from langsmith import Client

    # First, we validate the secret key we pass
    import os

    if secret != os.environ["LS_WEBHOOK"]:
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail="Incorrect bearer token",
            headers={"WWW-Authenticate": "Bearer"},
        )

    # This is where we put the logic for what should happen inside this webhook
    ls_client = Client()
    runs = data["runs"]
    ids = [r["id"] for r in runs]
    feedback = list(ls_client.list_feedback(run_ids=ids))
    for r, f in zip(runs, feedback):
        try:
            ls_client.create_example(
                inputs=r["inputs"],
                outputs={"output": f.correction},
                dataset_name="classifier-github-issues",
            )
        except Exception:
            raise ValueError(f"{r} and {f}")
    # Function body
    return "success!"
```

ì´ì œ `modal deploy ...`ë¡œ ì‰½ê²Œ ë°°í¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ë¬¸ì„œëŠ” [ì—¬ê¸°](https://modal.com/docs/guide/managing-deployments) ì°¸ì¡°).

ì´ì œ ë‹¤ìŒê³¼ ê°™ì€ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```
âœ“ Created objects.
â”œâ”€â”€ ğŸ”¨ Created mount /Users/harrisonchase/workplace/langsmith-docs/example-webhook.py
â”œâ”€â”€ ğŸ”¨ Created mount PythonPackage:langsmith
â””â”€â”€ ğŸ”¨ Created f => https://hwchase17--auth-example-f.modal.run
âœ“ App deployed! ğŸ‰

View Deployment: https://modal.com/apps/hwchase17/auth-example
```

ê¸°ì–µí•´ì•¼ í•  ì¤‘ìš”í•œ ê²ƒì€ `https://hwchase17--auth-example-f.modal.run` - ì‹¤í–‰í•˜ê¸° ìœ„í•´ ìƒì„±í•œ functionì…ë‹ˆë‹¤.
ì°¸ê³ : ì´ê²ƒì€ ìµœì¢… ë°°í¬ URLì´ ì•„ë‹ˆë¯€ë¡œ ì‹¤ìˆ˜ë¡œ ì‚¬ìš©í•˜ì§€ ì•Šë„ë¡ ì£¼ì˜í•˜ì„¸ìš”.

### Hooking it up

ì´ì œ ìœ„ì—ì„œ ìƒì„±í•œ function URLì„ ê°€ì ¸ì™€ì„œ webhookìœ¼ë¡œ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
query parameterë¡œ secret keyë„ ì „ë‹¬í•´ì•¼ í•œë‹¤ëŠ” ê²ƒì„ ê¸°ì–µí•´ì•¼ í•©ë‹ˆë‹¤.
ëª¨ë‘ í•©ì¹˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ë³´ì¼ ê²ƒì…ë‹ˆë‹¤:

```
https://hwchase17--auth-example-f-dev.modal.run?secret={SECRET}
```

`{SECRET}`ì„ Modal serviceì— ì•¡ì„¸ìŠ¤í•˜ê¸° ìœ„í•´ ìƒì„±í•œ secret keyë¡œ ë°”ê¾¸ì„¸ìš”.