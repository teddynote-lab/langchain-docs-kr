---
title: Azure Cosmos DB NoSQL Semantic Cache
---

> Semantic Cache 기능은 Azure Cosmos DB for NoSQL 통합에서 지원되며, 사용자 입력과 이전에 캐시된 결과 간의 의미적 유사성을 기반으로 캐시된 응답을 검색할 수 있게 해줍니다. 이 기능은 캐시된 프롬프트의 vector embedding을 저장하는 [AzureCosmosDBNoSQLVectorStore](/oss/integrations/vectorstores/azure_cosmosdb_nosql)를 활용합니다. 이러한 embedding은 유사성 기반 검색을 가능하게 하여 시스템이 관련된 캐시된 결과를 검색할 수 있도록 합니다.

Azure 계정이 없는 경우, [무료 계정을 생성](https://azure.microsoft.com/free/)하여 시작할 수 있습니다.

## Setup

먼저 [`@langchain/azure-cosmosdb`](https://www.npmjs.com/package/@langchain/azure-cosmosdb) package를 설치해야 합니다:

<Tip>
LangChain package 설치에 대한 일반적인 지침은 [이 섹션](/oss/langchain/install)을 참조하세요.
</Tip>

```bash npm
npm install @langchain/azure-cosmosdb @langchain/core
```

또한 Azure Cosmos DB for NoSQL 인스턴스가 실행 중이어야 합니다. [이 가이드](https://learn.microsoft.com/azure/cosmos-db/nosql/quickstart-portal)를 따라 Azure Portal에서 무료 버전을 비용 없이 배포할 수 있습니다.

인스턴스가 실행되면 connection string이 있는지 확인하세요. Managed Identity를 사용하는 경우 endpoint가 필요합니다. Azure Portal의 인스턴스 "Settings / Keys" 섹션에서 찾을 수 있습니다.

<Info>
**Azure Managed Identity와 role-based access control을 사용할 때는 database와 container가 미리 생성되어 있어야 합니다. RBAC는 database와 container를 생성할 수 있는 권한을 제공하지 않습니다. permission model에 대한 자세한 정보는 [Azure Cosmos DB 문서](https://learn.microsoft.com/azure/cosmos-db/how-to-setup-rbac#permission-model)에서 확인할 수 있습니다.**


</Info>

## Usage example

```typescript
import {
  AzureCosmosDBNoSQLConfig,
  AzureCosmosDBNoSQLSemanticCache,
} from "@langchain/azure-cosmosdb";
import { ChatOpenAI, OpenAIEmbeddings } from "@langchain/openai";

const embeddings = new OpenAIEmbeddings();
const config: AzureCosmosDBNoSQLConfig = {
  databaseName: "<DATABASE_NAME>",
  containerName: "<CONTAINER_NAME>",
  // use endpoint to initiate client with managed identity
  connectionString: "<CONNECTION_STRING>",
};

/**
 * Sets the threshold similarity score for returning cached results based on vector distance.
 * Cached output is returned only if the similarity score meets or exceeds this threshold;
 * otherwise, a new result is generated. Default is 0.6, adjustable via the constructor
 * to suit various distance functions and use cases.
 * (see: https://aka.ms/CosmosVectorSearch).
 */

const similarityScoreThreshold = 0.5;
const cache = new AzureCosmosDBNoSQLSemanticCache(
  embeddings,
  config,
  similarityScoreThreshold
);

const model = new ChatOpenAI({ model: "gpt-4o-mini", cache });

// Invoke the model to perform an action
const response1 = await model.invoke("Do something random!");
console.log(response1);
/*
  AIMessage {
    content: "Sure! I'll generate a random number for you: 37",
    additional_kwargs: {}
  }
*/

const response2 = await model.invoke("Do something random!");
console.log(response2);
/*
  AIMessage {
    content: "Sure! I'll generate a random number for you: 37",
    additional_kwargs: {}
  }
*/
```