---
title: Google Cloud SQL for PostgreSQL
---

[Cloud SQL](https://cloud.google.com/sql)은 고성능, 원활한 통합, 뛰어난 확장성을 제공하는 완전 관리형 관계형 데이터베이스 서비스로, PostgreSQL과 같은 데이터베이스 엔진을 제공합니다.

이 가이드는 `PostgresLoader` 클래스를 사용하여 Cloud SQL for PostgreSQL로 Document를 로드하는 방법에 대한 간단한 개요를 제공합니다.

## 개요

### 시작하기 전에

이 패키지를 사용하려면 먼저 다음 단계를 거쳐야 합니다:

1.  [Cloud Platform 프로젝트를 선택하거나 생성합니다.](https://developers.google.com/workspace/guides/create-project)
2.  [프로젝트에 대한 결제를 활성화합니다.](https://cloud.google.com/billing/docs/how-to/modify-project#enable_billing_for_a_project)
3.  [Cloud SQL Admin API를 활성화합니다.](https://console.cloud.google.com/flows/enableapi?apiid=sqladmin.googleapis.com)
4.  [인증을 설정합니다.](https://cloud.google.com/docs/authentication)
5.  [CloudSQL 인스턴스를 생성합니다](https://cloud.google.com/sql/docs/postgres/connect-instance-auth-proxy#create-instance)
6.  [CloudSQL 데이터베이스를 생성합니다](https://cloud.google.com/sql/docs/postgres/create-manage-databases)
7.  [데이터베이스에 사용자를 추가합니다](https://cloud.google.com/sql/docs/postgres/create-manage-users)

### 인증

`gcloud auth login` 명령을 사용하여 Google Cloud 계정에 로컬로 인증합니다.

### Google Cloud 프로젝트 설정

로컬에서 Google Cloud 리소스를 활용하려면 Google Cloud 프로젝트 ID를 설정하세요:

```bash
gcloud config set project YOUR-PROJECT-ID
```

프로젝트 ID를 모르는 경우 다음을 시도해보세요:

- `gcloud config list`를 실행합니다.
- `gcloud projects list`를 실행합니다.
- 지원 페이지를 참조하세요: [프로젝트 ID 찾기](https://support.google.com/googleapi/answer/7014113).

## PostgresLoader 인스턴스 설정하기

PostgresLoader 클래스를 사용하려면 `@langchain/google-cloud-sql-pg` 패키지를 설치한 다음 아래 단계를 따라야 합니다.

먼저 Google Cloud 계정에 로그인하고 Google Cloud 프로젝트를 기반으로 다음 환경 변수를 설정해야 합니다. 이는 PostgresEngine 인스턴스를 구성하는 방법(fromInstance, fromEngine, fromEngineArgs)에 따라 정의됩니다:

```bash
PROJECT_ID="your-project-id"
REGION="your-project-region" // example: "us-central1"
INSTANCE_NAME="your-instance"
DB_NAME="your-database-name"
DB_USER="your-database-user"
PASSWORD="your-database-password"
```

### 인스턴스 설정하기

PostgresLoader를 인스턴스화하려면 먼저 PostgresEngine을 통해 데이터베이스 연결을 생성해야 합니다.

```typescript
import {
  PostgresLoader,
  PostgresEngine,
  PostgresEngineArgs,
} from "@langchain/google-cloud-sql-pg";
import * as dotenv from "dotenv";

dotenv.config();

const peArgs: PostgresEngineArgs = {
  user: process.env.DB_USER ?? "",
  password: process.env.PASSWORD ?? "",
};

// PostgresEngine instantiation
const engine: PostgresEngine = await PostgresEngine.fromInstance(
  process.env.PROJECT_ID ?? "",
  process.env.REGION ?? "",
  process.env.INSTANCE_NAME ?? "",
  process.env.DB_NAME ?? "",
  peArgs
);
```

### table_name 인수를 사용하여 Document 로드하기

loader는 첫 번째 열을 page_content로, 다른 모든 열을 metadata로 사용하여 테이블에서 Document 목록을 반환합니다. 기본 테이블은 첫 번째 열을 page_content로, 두 번째 열을 metadata(JSON)로 갖습니다. 각 행은 하나의 document가 됩니다.

```js
const documentLoaderArgs: PostgresLoaderOptions = {
  tableName: "test_table_custom",
  contentColumns: ["fruit_name", "variety"],
  metadataColumns: [
    "fruit_id",
    "quantity_in_stock",
    "price_per_unit",
    "organic",
  ],
  format: "text",
};

const documentLoaderInstance = await PostgresLoader.initialize(
  PEInstance,
  documentLoaderArgs
);
```

### SQL 쿼리를 사용하여 Document 로드하기

query 매개변수를 사용하면 사용자가 데이터베이스에서 특정 document를 로드하기 위한 필터를 포함할 수 있는 사용자 정의 SQL 쿼리를 지정할 수 있습니다.

```js
const documentLoaderArgs: PostgresLoaderOptions = {
  query: "SELECT * FROM my_fruit_table",
  contentColumns: ["fruit_name", "variety"],
  metadataColumns: [
    "fruit_id",
    "quantity_in_stock",
    "price_per_unit",
    "organic",
  ],
  format: "text",
};

const documentLoaderInstance = await PostgresLoader.initialize(
  PEInstance,
  docucumetLoaderArgs
);
```

### page content 형식 설정

loader는 행당 하나의 document로 구성된 Document 목록을 반환하며, page content는 지정된 문자열 형식(예: text(공백으로 구분된 연결), JSON, YAML, CSV 등)으로 제공됩니다. JSON 및 YAML 형식에는 헤더가 포함되지만, text 및 CSV는 필드 헤더를 포함하지 않습니다.