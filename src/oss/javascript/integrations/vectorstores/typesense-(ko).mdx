---
title: Typesense
---

Typesense 검색 엔진을 활용하는 vector store입니다.

### 기본 사용법

<Tip>
LangChain 패키지 설치에 대한 일반적인 지침은 [이 섹션](/oss/langchain/install)을 참조하세요.
</Tip>

```bash npm
npm install @langchain/openai @langchain/community @langchain/core
```
```typescript
import {
  Typesense,
  TypesenseConfig,
} from "@lanchain/community/vectorstores/typesense";
import { OpenAIEmbeddings } from "@langchain/openai";
import { Client } from "typesense";
import { Document } from "@langchain/core/documents";

const vectorTypesenseClient = new Client({
  nodes: [
    {
      // Ideally should come from your .env file
      host: "...",
      port: 123,
      protocol: "https",
    },
  ],
  // Ideally should come from your .env file
  apiKey: "...",
  numRetries: 3,
  connectionTimeoutSeconds: 60,
});

const typesenseVectorStoreConfig = {
  // Typesense client
  typesenseClient: vectorTypesenseClient,
  // Name of the collection to store the vectors in
  schemaName: "your_schema_name",
  // Optional column names to be used in Typesense
  columnNames: {
    // "vec" is the default name for the vector column in Typesense but you can change it to whatever you want
    vector: "vec",
    // "text" is the default name for the text column in Typesense but you can change it to whatever you want
    pageContent: "text",
    // Names of the columns that you will save in your typesense schema and need to be retrieved as metadata when searching
    metadataColumnNames: ["foo", "bar", "baz"],
  },
  // Optional search parameters to be passed to Typesense when searching
  searchParams: {
    q: "*",
    filter_by: "foo:[fooo]",
    query_by: "",
  },
  // You can override the default Typesense import function if you want to do something more complex
  // Default import function:
  // async importToTypesense<
  //   T extends Record<string, unknown> = Record<string, unknown>
  // >(data: T[], collectionName: string) {
  //   const chunkSize = 2000;
  //   for (let i = 0; i < data.length; i += chunkSize) {
  //     const chunk = data.slice(i, i + chunkSize);

  //     await this.caller.call(async () => {
  //       await this.client
  //         .collections<T>(collectionName)
  //         .documents()
  //         .import(chunk, { action: "emplace", dirty_values: "drop" });
  //     });
  //   }
  // }
  import: async (data, collectionName) => {
    await vectorTypesenseClient
      .collections(collectionName)
      .documents()
      .import(data, { action: "emplace", dirty_values: "drop" });
  },
} satisfies TypesenseConfig;

/**
 * Creates a Typesense vector store from a list of documents.
 * Will update documents if there is a document with the same id, at least with the default import function.
 * @param documents list of documents to create the vector store from
 * @returns Typesense vector store
 */
const createVectorStoreWithTypesense = async (documents: Document[] = []) =>
  Typesense.fromDocuments(
    documents,
    new OpenAIEmbeddings(),
    typesenseVectorStoreConfig
  );

/**
 * Returns a Typesense vector store from an existing index.
 * @returns Typesense vector store
 */
const getVectorStoreWithTypesense = async () =>
  new Typesense(new OpenAIEmbeddings(), typesenseVectorStoreConfig);

// Do a similarity search
const vectorStore = await getVectorStoreWithTypesense();
const documents = await vectorStore.similaritySearch("hello world");

// Add filters based on metadata with the search parameters of Typesense
// will exclude documents with author:JK Rowling, so if Joe Rowling & JK Rowling exists, only Joe Rowling will be returned
vectorStore.similaritySearch("Rowling", undefined, {
  filter_by: "author:!=JK Rowling",
});

// Delete a document
vectorStore.deleteDocuments(["document_id_1", "document_id_2"]);
```

### Constructor

시작하기 전에 Typesense에서 id, vector를 위한 필드, text를 위한 필드를 포함하는 schema를 생성하세요. metadata를 위해 필요한 만큼 다른 필드를 추가하세요.

- `constructor(embeddings: Embeddings, config: TypesenseConfig)`: `Typesense` 클래스의 새 인스턴스를 생성합니다.
  - `embeddings`: 문서를 embedding하는 데 사용되는 @[`Embeddings`] 클래스의 인스턴스입니다.
  - `config`: Typesense vector store를 위한 구성 객체입니다.
    - `typesenseClient`: Typesense client 인스턴스입니다.
    - `schemaName`: 문서가 저장되고 검색될 Typesense schema의 이름입니다.
    - `searchParams` (선택사항): Typesense 검색 매개변수입니다. 기본값은 `{ q: '*', per_page: 5, query_by: '' }`입니다.
    - `columnNames` (선택사항): 컬럼 이름 구성입니다.
      - `vector` (선택사항): Vector 컬럼 이름입니다. 기본값은 `'vec'`입니다.
      - `pageContent` (선택사항): Page content 컬럼 이름입니다. 기본값은 `'text'`입니다.
      - `metadataColumnNames` (선택사항): Metadata 컬럼 이름들입니다. 기본값은 빈 배열 `[]`입니다.
    - `import` (선택사항): Typesense로 데이터를 import하기 위한 기본 import 함수를 대체합니다. 이는 문서 업데이트 기능에 영향을 줄 수 있습니다.

### Methods

- `async addDocuments(documents: Document[]): Promise<void>`: vector store에 문서를 추가합니다. 동일한 ID를 가진 문서가 있으면 업데이트됩니다.
- `static async fromDocuments(docs: Document[], embeddings: Embeddings, config: TypesenseConfig): Promise<Typesense>`: 문서 목록으로부터 Typesense vector store를 생성합니다. 문서는 생성 중에 vector store에 추가됩니다.
- `static async fromTexts(texts: string[], metadatas: object[], embeddings: Embeddings, config: TypesenseConfig): Promise<Typesense>`: 텍스트 목록과 관련 metadata로부터 Typesense vector store를 생성합니다. 텍스트는 문서로 변환되어 생성 중에 vector store에 추가됩니다.
- `async similaritySearch(query: string, k?: number, filter?: Record<string, unknown>): Promise<Document[]>`: query를 기반으로 유사한 문서를 검색합니다. 유사한 문서의 배열을 반환합니다.
- `async deleteDocuments(documentIds: string[]): Promise<void>`: ID를 기반으로 vector store에서 문서를 삭제합니다.

## Related

- Vector store [개념 가이드](/oss/integrations/vectorstores)
- Vector store [사용 방법 가이드](/oss/integrations/vectorstores)