---
title: Vercel Postgres
---

LangChain.js는 [`@vercel/postgres`](https://www.npmjs.com/package/@vercel/postgres) 패키지를 사용하여 [`pgvector`](https://github.com/pgvector/pgvector) Postgres 확장을 지원하는 일반 Postgres 데이터베이스를 vector store로 사용할 수 있도록 지원합니다.

이 통합은 Edge function과 같은 웹 환경에서 특히 유용합니다.

## Setup

Vercel Postgres를 사용하려면 `@vercel/postgres` 패키지를 설치해야 합니다:

```bash npm
npm install @vercel/postgres
```
<Tip>
LangChain 패키지 설치에 대한 일반적인 지침은 [이 섹션](/oss/langchain/install)을 참조하세요.
</Tip>

```bash npm
npm install @langchain/community @langchain/core
```
이 통합은 `process.env.POSTGRES_URL`에 설정된 connection string을 사용하여 자동으로 연결됩니다.
다음과 같이 connection string을 수동으로 전달할 수도 있습니다:

```typescript
const vectorstore = await VercelPostgres.initialize(new OpenAIEmbeddings(), {
  postgresConnectionOptions: {
    connectionString:
      "postgres://<username>:<password>@<hostname>:<port>/<dbname>",
  },
});
```

### Vercel Postgres에 연결하기

시작하는 간단한 방법은 서버리스 [Vercel Postgres 인스턴스](https://vercel.com/docs/storage/vercel-postgres/quickstart)를 생성하는 것입니다.
Vercel Postgres 인스턴스가 연결된 Vercel 프로젝트에 배포하는 경우, 필요한 `POSTGRES_URL` 환경 변수가 호스팅 환경에 이미 설정되어 있습니다.

### 다른 데이터베이스에 연결하기

자체 Postgres 인스턴스를 호스팅하려는 경우, LangChain의 [PGVector](/oss/integrations/vectorstores/pgvector) vectorstore 통합과 유사한 방식을 사용하고 connection string을 환경 변수로 설정하거나 위에 표시된 대로 설정할 수 있습니다.

## Usage

```typescript
import { CohereEmbeddings } from "@langchain/cohere";
import { VercelPostgres } from "@langchain/community/vectorstores/vercel_postgres";

// Config is only required if you want to override default values.
const config = {
  // tableName: "testvercelvectorstorelangchain",
  // postgresConnectionOptions: {
  //   connectionString: "postgres://<username>:<password>@<hostname>:<port>/<dbname>",
  // },
  // columns: {
  //   idColumnName: "id",
  //   vectorColumnName: "vector",
  //   contentColumnName: "content",
  //   metadataColumnName: "metadata",
  // },
};

const vercelPostgresStore = await VercelPostgres.initialize(
  new CohereEmbeddings({ model: "embed-english-v3.0" }),
  config
);

const docHello = {
  pageContent: "hello",
  metadata: { topic: "nonsense" },
};
const docHi = { pageContent: "hi", metadata: { topic: "nonsense" } };
const docMitochondria = {
  pageContent: "Mitochondria is the powerhouse of the cell",
  metadata: { topic: "science" },
};

const ids = await vercelPostgresStore.addDocuments([
  docHello,
  docHi,
  docMitochondria,
]);

const results = await vercelPostgresStore.similaritySearch("hello", 2);
console.log(results);
/*
  [
    Document { pageContent: 'hello', metadata: { topic: 'nonsense' } },
    Document { pageContent: 'hi', metadata: { topic: 'nonsense' } }
  ]
*/

// Metadata filtering
const results2 = await vercelPostgresStore.similaritySearch(
  "Irrelevant query, metadata filtering",
  2,
  {
    topic: "science",
  }
);
console.log(results2);
/*
  [
    Document {
      pageContent: 'Mitochondria is the powerhouse of the cell',
      metadata: { topic: 'science' }
    }
  ]
*/

// Metadata filtering with IN-filters works as well
const results3 = await vercelPostgresStore.similaritySearch(
  "Irrelevant query, metadata filtering",
  3,
  {
    topic: { in: ["science", "nonsense"] },
  }
);
console.log(results3);
/*
  [
    Document {
      pageContent: 'hello',
      metadata: { topic: 'nonsense' }
    },
    Document {
      pageContent: 'hi',
      metadata: { topic: 'nonsense' }
    },
    Document {
      pageContent: 'Mitochondria is the powerhouse of the cell',
      metadata: { topic: 'science' }
    }
  ]
*/

// Upserting is supported as well
await vercelPostgresStore.addDocuments(
  [
    {
      pageContent: "ATP is the powerhouse of the cell",
      metadata: { topic: "science" },
    },
  ],
  { ids: [ids[2]] }
);

const results4 = await vercelPostgresStore.similaritySearch(
  "What is the powerhouse of the cell?",
  1
);
console.log(results4);
/*
  [
    Document {
      pageContent: 'ATP is the powerhouse of the cell',
      metadata: { topic: 'science' }
    }
  ]
*/

await vercelPostgresStore.delete({ ids: [ids[2]] });

const results5 = await vercelPostgresStore.similaritySearch(
  "No more metadata",
  2,
  {
    topic: "science",
  }
);
console.log(results5);
/*
  []
*/

// Remember to call .end() to close the connection!
await vercelPostgresStore.end();
```

## Related

- Vector store [개념 가이드](/oss/integrations/vectorstores)
- Vector store [사용 방법 가이드](/oss/integrations/vectorstores)
```