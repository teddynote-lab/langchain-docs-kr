```mdx
---
title: MariaDB
---

<Tip>
**호환성**: Node.js에서만 사용 가능합니다.
</Tip>

MariaDB 11.7 이상 버전이 필요합니다

이 가이드는 mariadb [vector store](/oss/integrations/vectorstores) 시작하기에 대한 간단한 개요를 제공합니다. 모든 `MariaDB store` 기능 및 구성에 대한 자세한 문서는 [API reference](https://api.js.langchain.com/classes/langchain_community_vectorstores_mariadb.MariaDBStore.html)를 참조하세요.

## 개요

### Integration 세부 정보

| Class | Package | [PY support](https://python.langchain.com/docs/integrations/vectorstores/mariadb/) | Version |
| :--- | :--- | :---: | :---: |
| [`MariaDBStore`](https://api.js.langchain.com/classes/langchain_community_vectorstores_mariadb.MariaDBStore.html) | [`@langchain/community`](https://npmjs.com/@langchain/community) | ✅ | ![NPM - Version](https://img.shields.io/npm/v/@langchain/community?style=flat-square&label=%20&) |

## 설정

MariaDBVector vector store를 사용하려면 [`mariadb`](https://www.npmjs.com/package/mariadb) connector를 peer dependency로 사용하는 MariaDB 11.7 이상 버전을 설정해야 합니다.

이 가이드는 [OpenAI embeddings](/oss/integrations/text_embedding/openai)도 사용하며, 이를 위해 `@langchain/openai` integration package를 설치해야 합니다. 원하는 경우 [다른 지원되는 embeddings model](/oss/integrations/text_embedding)을 사용할 수도 있습니다.

또한 필요한 형식의 id를 생성하기 위해 [`uuid`](https://www.npmjs.com/package/uuid) package를 사용합니다.

<CodeGroup>
```bash npm
npm install @langchain/community @langchain/openai @langchain/core mariadb uuid
```
```bash yarn
yarn add @langchain/community @langchain/openai @langchain/core mariadb uuid
```
```bash pnpm
pnpm add @langchain/community @langchain/openai @langchain/core mariadb uuid
```
</CodeGroup>

### 인스턴스 설정

다음 내용으로 docker-compose.yml이라는 파일을 생성합니다:

```yaml
# Run this command to start the database:
# docker-compose up --build
version: "3"
services:
  db:
    hostname: 127.0.0.1
    image: mariadb/mariadb:11.7-rc
    ports:
      - 3306:3306
    restart: always
    environment:
      - MARIADB_DATABASE=api
      - MARIADB_USER=myuser
      - MARIADB_PASSWORD=ChangeMe
      - MARIADB_ROOT_PASSWORD=ChangeMe
    volumes:
      - ./init.sql:/docker-entrypoint-initdb.d/init.sql
```

그런 다음 같은 디렉토리에서 docker compose up을 실행하여 container를 시작합니다.

### 자격 증명

MariaDB 인스턴스에 연결하려면 해당 자격 증명이 필요합니다. 지원되는 옵션의 전체 목록은 [`mariadb` docs](https://github.com/mariadb-corporation/mariadb-connector-nodejs/blob/master/documentation/promise-api.md#connection-options)를 참조하세요.

이 가이드에서 OpenAI embeddings를 사용하는 경우 OpenAI key도 설정해야 합니다:

```typescript
process.env.OPENAI_API_KEY = "YOUR_API_KEY";
```

model 호출에 대한 자동 추적을 원하는 경우 아래 주석을 해제하여 [LangSmith](https://docs.smith.langchain.com/) API key를 설정할 수도 있습니다:

```typescript
// process.env.LANGCHAIN_TRACING_V2="true"
// process.env.LANGCHAIN_API_KEY="your-api-key"
```

## 인스턴스화

vector store를 인스턴스화하려면 `.initialize()` static method를 호출합니다. 이는 전달된 `config`의 `tableName`으로 지정된 table의 존재 여부를 자동으로 확인합니다. 존재하지 않으면 필요한 column으로 생성합니다.

```typescript
import { OpenAIEmbeddings } from "@langchain/openai";

import {
   DistanceStrategy,
   MariaDBStore,
} from "@langchain/community/vectorstores/mariadb";
import { PoolConfig } from "mariadb";

const config = {
  connectionOptions: {
    type: "mariadb",
    host: "127.0.0.1",
    port: 3306,
    user: "myuser",
    password: "ChangeMe",
    database: "api",
  } as PoolConfig,
  distanceStrategy: 'EUCLIDEAN' as DistanceStrategy,
};
const vectorStore = await MariaDBStore.initialize(
  new OpenAIEmbeddings(),
   config
);
```

## Vector store 관리

### Vector store에 항목 추가

```typescript
import { v4 as uuidv4 } from "uuid";
import type { Document } from "@langchain/core/documents";

const document1: Document = {
  pageContent: "The powerhouse of the cell is the mitochondria",
  metadata: { source: "https://example.com" }
};

const document2: Document = {
  pageContent: "Buildings are made out of brick",
  metadata: { source: "https://example.com" }
};

const document3: Document = {
  pageContent: "Mitochondria are made out of lipids",
  metadata: { source: "https://example.com" }
};

const document4: Document = {
  pageContent: "The 2024 Olympics are in Paris",
  metadata: { source: "https://example.com" }
}

const documents = [document1, document2, document3, document4];

const ids = [uuidv4(), uuidv4(), uuidv4(), uuidv4()]

// ids are not mandatory, but that's for the example
await vectorStore.addDocuments(documents, { ids: ids });
```

### Vector store에서 항목 삭제

```typescript
const id4 = ids[ids.length - 1];

await vectorStore.delete({ ids: [id4] });
```

## Vector store 쿼리

Vector store가 생성되고 관련 document가 추가되면 chain 또는 agent를 실행하는 동안 쿼리하고 싶을 것입니다.

### 직접 쿼리

간단한 유사도 검색은 다음과 같이 수행할 수 있습니다:

```typescript
const similaritySearchResults = await vectorStore.similaritySearch("biology", 2, { "year": 2021 });
for (const doc of similaritySearchResults) {
  console.log(`* ${doc.pageContent} [${JSON.stringify(doc.metadata, null)}]`);
}
```

```output
* The powerhouse of the cell is the mitochondria [{"year": 2021}]
* Mitochondria are made out of lipids [{"year": 2022}]
```

위의 filter 구문은 더 복잡할 수 있습니다:

```json
# name = 'martin' OR firstname = 'john'
let res = await vectorStore.similaritySearch("biology", 2, {"$or": [{"name":"martin"}, {"firstname", "john"}] });
```

유사도 검색을 실행하고 해당 score를 받으려면 다음을 실행할 수 있습니다:

```typescript
const similaritySearchWithScoreResults = await vectorStore.similaritySearchWithScore("biology", 2)

for (const [doc, score] of similaritySearchWithScoreResults) {
  console.log(`* [SIM=${score.toFixed(3)}] ${doc.pageContent} [${JSON.stringify(doc.metadata)}]`);
}
```

```output
* [SIM=0.835] The powerhouse of the cell is the mitochondria [{"source":"https://example.com"}]
* [SIM=0.852] Mitochondria are made out of lipids [{"source":"https://example.com"}]
```

### Retriever로 변환하여 쿼리

Vector store를 [retriever](/oss/langchain/retrieval)로 변환하여 chain에서 더 쉽게 사용할 수도 있습니다.

```typescript
const retriever = vectorStore.asRetriever({
  // Optional filter
  // filter: filter,
  k: 2,
});
await retriever.invoke("biology");
```

```output
[
  Document {
    pageContent: 'The powerhouse of the cell is the mitochondria',
    metadata: { source: 'https://example.com' },
    id: undefined
  },
  Document {
    pageContent: 'Mitochondria are made out of lipids',
    metadata: { source: 'https://example.com' },
    id: undefined
  }
]
```

### Retrieval-augmented generation 사용

Retrieval-augmented generation (RAG)에 이 vector store를 사용하는 방법에 대한 가이드는 다음 섹션을 참조하세요:

- [LangChain으로 RAG 앱 만들기](/oss/langchain/rag)
- [Agentic RAG](/oss/langgraph/agentic-rag)
- [Retrieval 문서](/oss/langchain/retrieval)

## 고급: connection 재사용

Pool을 생성한 다음 constructor를 통해 직접 새 `MariaDBStore` 인스턴스를 생성하여 connection을 재사용할 수 있습니다.

Constructor를 사용하기 전에 table을 올바르게 설정하려면 최소한 한 번은 `.initialize()`를 호출하여 database를 설정해야 합니다.

```typescript
import { OpenAIEmbeddings } from "@langchain/openai";
import { MariaDBStore } from "@langchain/community/vectorstores/mariadb";
import mariadb from "mariadb";

// First, follow set-up instructions at
// https://js.langchain.com/docs/modules/indexes/vector_stores/integrations/mariadb

const reusablePool = mariadb.createPool({
  host: "127.0.0.1",
  port: 3306,
  user: "myuser",
  password: "ChangeMe",
  database: "api",
});

const originalConfig = {
  pool: reusablePool,
  tableName: "testlangchainjs",
  collectionName: "sample",
  collectionTableName: "collections",
  columns: {
    idColumnName: "id",
    vectorColumnName: "vect",
    contentColumnName: "content",
    metadataColumnName: "metadata",
  },
};

// Set up the DB.
// Can skip this step if you've already initialized the DB.
// await MariaDBStore.initialize(new OpenAIEmbeddings(), originalConfig);
const mariadbStore = new MariaDBStore(new OpenAIEmbeddings(), originalConfig);

await mariadbStore.addDocuments([
  { pageContent: "what's this", metadata: { a: 2 } },
  { pageContent: "Cat drinks milk", metadata: { a: 1 } },
]);

const results = await mariadbStore.similaritySearch("water", 1);

console.log(results);

/*
  [ Document { pageContent: 'Cat drinks milk', metadata: { a: 1 } } ]
*/

const mariadbStore2 = new MariaDBStore(new OpenAIEmbeddings(), {
  pool: reusablePool,
  tableName: "testlangchainjs",
  collectionTableName: "collections",
  collectionName: "some_other_collection",
  columns: {
    idColumnName: "id",
    vectorColumnName: "vector",
    contentColumnName: "content",
    metadataColumnName: "metadata",
  },
});

const results2 = await mariadbStore2.similaritySearch("water", 1);

console.log(results2);

/*
  []
*/

await reusablePool.end();
```

## Connection 닫기

과도한 리소스 소비를 방지하기 위해 작업이 완료되면 connection을 닫아야 합니다:

```typescript
await vectorStore.end();
```

## API reference

모든 `MariaDBStore` 기능 및 구성에 대한 자세한 문서는 [API reference](https://api.js.langchain.com/classes/langchain_community_vectorstores_mariadb.MariaDBStore.html)를 참조하세요.
```