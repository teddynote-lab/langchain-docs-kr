---
title: SupabaseVectorStore
---

[Supabase](https://supabase.com/docs)는 오픈소스 Firebase 대안입니다. Supabase는 PostgreSQL 위에 구축되어 강력한 SQL 쿼리 기능을 제공하며 기존 도구 및 프레임워크와의 간단한 인터페이스를 가능하게 합니다.

LangChain.js는 [`pgvector`](https://github.com/pgvector/pgvector) 확장을 사용하여 Supabase Postgres 데이터베이스를 vector store로 사용하는 것을 지원합니다. 자세한 내용은 [Supabase 블로그 포스트](https://supabase.com/blog/openai-embeddings-postgres-vector)를 참조하세요.

이 가이드는 Supabase [vector stores](/oss/integrations/vectorstores) 시작하기에 대한 간단한 개요를 제공합니다. 모든 `SupabaseVectorStore` 기능 및 구성에 대한 자세한 문서는 [API reference](https://api.js.langchain.com/classes/langchain_community_vectorstores_supabase.SupabaseVectorStore.html)를 참조하세요.

## Overview

### Integration details

| Class | Package | [PY support](https://python.langchain.com/docs/integrations/vectorstores/supabase/) |  Version |
| :--- | :--- | :---: | :---: |
| [`SupabaseVectorStore`](https://api.js.langchain.com/classes/langchain_community_vectorstores_supabase.SupabaseVectorStore.html) | [`@langchain/community`](https://npmjs.com/@langchain/community) | ✅ |  ![NPM - Version](https://img.shields.io/npm/v/@langchain/community?style=flat-square&label=%20&) |

## Setup

Supabase vector stores를 사용하려면 Supabase 데이터베이스를 설정하고 `@langchain/community` integration package를 설치해야 합니다. 또한 공식 [`@supabase/supabase-js`](https://www.npmjs.com/package/@supabase/supabase-js) SDK를 peer dependency로 설치해야 합니다.

이 가이드는 [OpenAI embeddings](/oss/integrations/text_embedding/openai)도 사용하므로 `@langchain/openai` integration package를 설치해야 합니다. 원하는 경우 [다른 지원되는 embeddings models](/oss/integrations/text_embedding)를 사용할 수도 있습니다.

<CodeGroup>
```bash npm
npm install @langchain/community @langchain/core @supabase/supabase-js @langchain/openai
```
```bash yarn
yarn add @langchain/community @langchain/core @supabase/supabase-js @langchain/openai
```
```bash pnpm
pnpm add @langchain/community @langchain/core @supabase/supabase-js @langchain/openai
```
</CodeGroup>

데이터베이스를 생성한 후 다음 SQL을 실행하여 [`pgvector`](https://github.com/pgvector/pgvector)를 설정하고 필요한 테이블과 함수를 생성하세요:

```sql
-- Enable the pgvector extension to work with embedding vectors
create extension vector;

-- Create a table to store your documents
create table documents (
  id bigserial primary key,
  content text, -- corresponds to Document.pageContent
  metadata jsonb, -- corresponds to Document.metadata
  embedding vector(1536) -- 1536 works for OpenAI embeddings, change if needed
);

-- Create a function to search for documents
create function match_documents (
  query_embedding vector(1536),
  match_count int DEFAULT null,
  filter jsonb DEFAULT '{}'
) returns table (
  id bigint,
  content text,
  metadata jsonb,
  embedding jsonb,
  similarity float
)
language plpgsql
as $$
#variable_conflict use_column
begin
  return query
  select
    id,
    content,
    metadata,
    (embedding::text)::jsonb as embedding,
    1 - (documents.embedding <=> query_embedding) as similarity
  from documents
  where metadata @> filter
  order by documents.embedding <=> query_embedding
  limit match_count;
end;
$$;
```

### Credentials

이 작업을 완료한 후 `SUPABASE_PRIVATE_KEY` 및 `SUPABASE_URL` 환경 변수를 설정하세요:

```typescript
process.env.SUPABASE_PRIVATE_KEY = "your-api-key";
process.env.SUPABASE_URL = "your-supabase-db-url";
```

이 가이드에서 OpenAI embeddings를 사용하는 경우 OpenAI key도 설정해야 합니다:

```typescript
process.env.OPENAI_API_KEY = "YOUR_API_KEY";
```

모델 호출에 대한 자동 추적을 원하는 경우 아래 주석을 해제하여 [LangSmith](https://docs.smith.langchain.com/) API key를 설정할 수도 있습니다:

```typescript
// process.env.LANGSMITH_TRACING="true"
// process.env.LANGSMITH_API_KEY="your-api-key"
```

## Instantiation

```typescript
import { SupabaseVectorStore } from "@langchain/community/vectorstores/supabase";
import { OpenAIEmbeddings } from "@langchain/openai";

import { createClient } from "@supabase/supabase-js";

const embeddings = new OpenAIEmbeddings({
  model: "text-embedding-3-small",
});

const supabaseClient = createClient(
  process.env.SUPABASE_URL,
  process.env.SUPABASE_PRIVATE_KEY
);

const vectorStore = new SupabaseVectorStore(embeddings, {
  client: supabaseClient,
  tableName: "documents",
  queryName: "match_documents",
});
```

## Manage vector store

### Add items to vector store

```typescript
import type { Document } from "@langchain/core/documents";

const document1: Document = {
  pageContent: "The powerhouse of the cell is the mitochondria",
  metadata: { source: "https://example.com" }
};

const document2: Document = {
  pageContent: "Buildings are made out of brick",
  metadata: { source: "https://example.com" }
};

const document3: Document = {
  pageContent: "Mitochondria are made out of lipids",
  metadata: { source: "https://example.com" }
};

const document4: Document = {
  pageContent: "The 2024 Olympics are in Paris",
  metadata: { source: "https://example.com" }
}

const documents = [document1, document2, document3, document4];

await vectorStore.addDocuments(documents, { ids: ["1", "2", "3", "4"] });
```

```output
[ 1, 2, 3, 4 ]
```

### Delete items from vector store

```typescript
await vectorStore.delete({ ids: ["4"] });
```

## Query vector store

vector store가 생성되고 관련 문서가 추가되면 chain 또는 agent를 실행하는 동안 쿼리하고 싶을 것입니다.

### Query directly

간단한 유사도 검색은 다음과 같이 수행할 수 있습니다:

```typescript
const filter = { source: "https://example.com" };

const similaritySearchResults = await vectorStore.similaritySearch("biology", 2, filter);

for (const doc of similaritySearchResults) {
  console.log(`* ${doc.pageContent} [${JSON.stringify(doc.metadata, null)}]`);
}
```

```output
* The powerhouse of the cell is the mitochondria [{"source":"https://example.com"}]
* Mitochondria are made out of lipids [{"source":"https://example.com"}]
```

유사도 검색을 실행하고 해당 점수를 받으려면 다음을 실행할 수 있습니다:

```typescript
const similaritySearchWithScoreResults = await vectorStore.similaritySearchWithScore("biology", 2, filter)

for (const [doc, score] of similaritySearchWithScoreResults) {
  console.log(`* [SIM=${score.toFixed(3)}] ${doc.pageContent} [${JSON.stringify(doc.metadata)}]`);
}
```

```output
* [SIM=0.165] The powerhouse of the cell is the mitochondria [{"source":"https://example.com"}]
* [SIM=0.148] Mitochondria are made out of lipids [{"source":"https://example.com"}]
```

### Metadata Query Builder Filtering

객체를 전달하는 대신 [Supabase JavaScript library](https://supabase.com/docs/reference/javascript/using-filters)가 작동하는 방식과 유사한 query builder 스타일 필터링을 사용할 수도 있습니다. 대부분의 필터 속성이 metadata 컬럼에 있으므로 [Postgrest API documentation](https://postgrest.org/en/stable/references/api/tables_views.html#json-columns)에 정의된 대로 arrow operators(정수의 경우 ->, 텍스트의 경우 ->>)를 사용하고 속성의 데이터 타입을 지정해야 합니다(예: 컬럼은 `metadata->some_int_prop_name::int`와 같아야 합니다).

```typescript
import { SupabaseFilterRPCCall } from "@langchain/community/vectorstores/supabase";

const funcFilter: SupabaseFilterRPCCall = (rpc) =>
  rpc.filter("metadata->>source", "eq", "https://example.com");

const funcFilterSearchResults = await vectorStore.similaritySearch("biology", 2, funcFilter);

for (const doc of funcFilterSearchResults) {
  console.log(`* ${doc.pageContent} [${JSON.stringify(doc.metadata, null)}]`);
}
```

```output
* The powerhouse of the cell is the mitochondria [{"source":"https://example.com"}]
* Mitochondria are made out of lipids [{"source":"https://example.com"}]
```

### Query by turning into retriever

vector store를 [retriever](/oss/langchain/retrieval)로 변환하여 chain에서 더 쉽게 사용할 수도 있습니다.

```typescript
const retriever = vectorStore.asRetriever({
  // Optional filter
  filter: filter,
  k: 2,
});
await retriever.invoke("biology");
```

```output
[
  Document {
    pageContent: 'The powerhouse of the cell is the mitochondria',
    metadata: { source: 'https://example.com' },
    id: undefined
  },
  Document {
    pageContent: 'Mitochondria are made out of lipids',
    metadata: { source: 'https://example.com' },
    id: undefined
  }
]
```

### Usage for retrieval-augmented generation

retrieval-augmented generation (RAG)을 위해 이 vector store를 사용하는 방법에 대한 가이드는 다음 섹션을 참조하세요:

- [Build a RAG app with LangChain](/oss/langchain/rag)
- [Agentic RAG](/oss/langgraph/agentic-rag)
- [Retrieval docs](/oss/langchain/retrieval)

## API reference

모든 `SupabaseVectorStore` 기능 및 구성에 대한 자세한 문서는 [API reference](https://api.js.langchain.com/classes/langchain_community_vectorstores_supabase.SupabaseVectorStore.html)를 참조하세요.