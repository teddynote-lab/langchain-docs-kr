---
title: MongoDB Atlas
---

<Tip>
**호환성**: Node.js에서만 사용 가능합니다.

아래와 같이 `runtime` 변수를 `nodejs`로 설정하면 Next.js에서 MongoDB를 사용하는 API route를 만들 수 있습니다:

`export const runtime = "nodejs";`

Edge runtime에 대한 자세한 내용은 Next.js 문서의 [여기](https://nextjs.org/docs/app/building-your-application/rendering/edge-and-nodejs-runtimes)에서 확인하세요.
</Tip>
```json
{
  "fields": [
    {
      "numDimensions": 1536,
      "path": "embedding",
      "similarity": "euclidean",
      "type": "vector"
    }
  ]
}
```
```bash
# npm로 패키지 설치
npm install @langchain/mongodb mongodb @langchain/openai @langchain/core
```
```bash
# yarn으로 패키지 설치
yarn add @langchain/mongodb mongodb @langchain/openai @langchain/core
```
```bash
# pnpm으로 패키지 설치
pnpm add @langchain/mongodb mongodb @langchain/openai @langchain/core
```
```typescript
// MongoDB Atlas 연결에 필요한 환경 변수 설정 예시
process.env.MONGODB_ATLAS_URI = "your-atlas-url";
process.env.MONGODB_ATLAS_COLLECTION_NAME = "your-atlas-db-name";
process.env.MONGODB_ATLAS_DB_NAME = "your-atlas-db-name";
```
```typescript
// OpenAI API Key 설정
process.env.OPENAI_API_KEY = "YOUR_API_KEY";
```
```typescript
// LangSmith 사용 시 선택적으로 활성화할 수 있는 설정
// process.env.LANGSMITH_TRACING="true"
// process.env.LANGSMITH_API_KEY="your-api-key"
```
```typescript
// MongoDB Atlas Vector Store와 OpenAI Embeddings 초기화 예시
import { MongoDBAtlasVectorSearch } from "@langchain/mongodb";
import { OpenAIEmbeddings } from "@langchain/openai";
import { MongoClient } from "mongodb";

// MongoDB 클라이언트 생성
const client = new MongoClient(process.env.MONGODB_ATLAS_URI || "");

// 대상 DB 및 컬렉션 지정
const collection = client.db(process.env.MONGODB_ATLAS_DB_NAME)
  .collection(process.env.MONGODB_ATLAS_COLLECTION_NAME);

// 임베딩 모델 설정 (OpenAI text-embedding-3-small)
const embeddings = new OpenAIEmbeddings({
  model: "text-embedding-3-small",
});

// Vector Store 인스턴스 생성
const vectorStore = new MongoDBAtlasVectorSearch(embeddings, {
  collection: collection,
  indexName: "vector_index", // Atlas Search 인덱스 이름 (기본값: "default")
  textKey: "text", // 원문 텍스트가 저장된 필드명 (기본값: "text")
  embeddingKey: "embedding", // 임베딩이 저장된 필드명 (기본값: "embedding")
});
```
```typescript
// 색인할 Document 예시 생성
import type { Document } from "@langchain/core/documents";

const document1: Document = {
  pageContent: "The powerhouse of the cell is the mitochondria",
  metadata: { source: "https://example.com" }
};

const document2: Document = {
  pageContent: "Buildings are made out of brick",
  metadata: { source: "https://example.com" }
};

const document3: Document = {
  pageContent: "Mitochondria are made out of lipids",
  metadata: { source: "https://example.com" }
};

const document4: Document = {
  pageContent: "The 2024 Olympics are in Paris",
  metadata: { source: "https://example.com" }
}

const documents = [document1, document2, document3, document4];

// 문서들을 Vector Store에 추가 (명시적 ID 사용)
await vectorStore.addDocuments(documents, { ids: ["1", "2", "3", "4"] });
```
```output
[ '1', '2', '3', '4' ]
```
```typescript
// 특정 문서 삭제 (ID 기반)
await vectorStore.delete({ ids: ["4"] });
```
```typescript
// 유사도 검색 실행 (쿼리 "biology", 상위 2개)
const similaritySearchResults = await vectorStore.similaritySearch("biology", 2);

for (const doc of similaritySearchResults) {
  console.log(`* ${doc.pageContent} [${JSON.stringify(doc.metadata, null)}]`);
}
```
```output
* The powerhouse of the cell is the mitochondria [{"_id":"1","source":"https://example.com"}]
* Mitochondria are made out of lipids [{"_id":"3","source":"https://example.com"}]
```
```json
{
  "fields": [
    {
      "numDimensions": 1024,
      "path": "embedding",
      "similarity": "euclidean",
      "type": "vector"
    },
    {
      "path": "source",
      "type": "filter"
    }
  ]
}
```
```typescript
// Atlas Search preFilter를 사용한 필터링 예시
const filter = {
  preFilter: {
    source: {
      $eq: "https://example.com",
    },
  },
}

// 필터를 적용한 유사도 검색
const filteredResults = await vectorStore.similaritySearch("biology", 2, filter);

for (const doc of filteredResults) {
  console.log(`* ${doc.pageContent} [${JSON.stringify(doc.metadata, null)}]`);
}
```
```output
* The powerhouse of the cell is the mitochondria [{"_id":"1","source":"https://example.com"}]
* Mitochondria are made out of lipids [{"_id":"3","source":"https://example.com"}]
```
```typescript
// 점수 포함 유사도 검색 (similaritySearchWithScore)
const similaritySearchWithScoreResults = await vectorStore.similaritySearchWithScore("biology", 2, filter)

for (const [doc, score] of similaritySearchWithScoreResults) {
  console.log(`* [SIM=${score.toFixed(3)}] ${doc.pageContent} [${JSON.stringify(doc.metadata)}]`);
}
```
```output
* [SIM=0.374] The powerhouse of the cell is the mitochondria [{"_id":"1","source":"https://example.com"}]
* [SIM=0.370] Mitochondria are made out of lipids [{"_id":"3","source":"https://example.com"}]
```
```typescript
// Retriever 인터페이스로 변환하여 검색에 사용
const retriever = vectorStore.asRetriever({
  // 선택적 필터
  filter: filter,
  k: 2,
});
await retriever.invoke("biology");
```
```output
[
  Document {
    pageContent: 'The powerhouse of the cell is the mitochondria',
    metadata: { _id: '1', source: 'https://example.com' },
    id: undefined
  },
  Document {
    pageContent: 'Mitochondria are made out of lipids',
    metadata: { _id: '3', source: 'https://example.com' },
    id: undefined
  }
]
```
```typescript
// 리소스 정리: MongoDB 클라이언트 종료
await client.close();
```

## API reference

`MongoDBAtlasVectorSearch`의 모든 기능과 설정에 대한 자세한 문서는 [API reference](https://api.js.langchain.com/classes/langchain_mongodb.MongoDBAtlasVectorSearch.html)에서 확인하세요.