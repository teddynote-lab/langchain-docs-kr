```mdx
---
title: NanoPQ (Product Quantization)
---

>[Product Quantization algorithm (k-NN)](https://towardsdatascience.com/similarity-search-product-quantization-b2a1a6397701)은 간단히 말해 대규모 데이터셋이 포함된 의미론적 검색에서 데이터베이스 벡터의 압축을 돕는 양자화 알고리즘입니다. 요약하자면, embedding이 M개의 부분 공간으로 분할되고 이후 클러스터링을 거칩니다. 벡터를 클러스터링하면 중심 벡터가 각 부분 공간의 클러스터에 존재하는 벡터들에 매핑됩니다.

이 노트북은 [nanopq](https://github.com/matsui528/nanopq) 패키지로 구현된 Product Quantization을 내부적으로 사용하는 retriever를 사용하는 방법을 다룹니다.

```python
pip install -qU langchain-community langchain-openai nanopq
```

```python
from langchain_community.embeddings.spacy_embeddings import SpacyEmbeddings
from langchain_community.retrievers import NanoPQRetriever
```

## 텍스트로 새 Retriever 생성하기

```python
retriever = NanoPQRetriever.from_texts(
    ["Great world", "great words", "world", "planets of the world"],
    SpacyEmbeddings(model_name="en_core_web_sm"),
    clusters=2,
    subspace=2,
)
```

## Retriever 사용하기

이제 retriever를 사용할 수 있습니다!

```python
retriever.invoke("earth")
```

```output
M: 2, Ks: 2, metric : <class 'numpy.uint8'>, code_dtype: l2
iter: 20, seed: 123
Training the subspace: 0 / 2
Training the subspace: 1 / 2
Encoding the subspace: 0 / 2
Encoding the subspace: 1 / 2
```

```output
[Document(page_content='world'),
 Document(page_content='Great world'),
 Document(page_content='great words'),
 Document(page_content='planets of the world')]
```

```python

```
```